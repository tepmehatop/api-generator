/**
 * –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä Happy Path API —Ç–µ—Å—Ç–æ–≤
 * –í–ï–†–°–ò–Ø 14.5.9 - –£–ú–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø + –£–õ–£–ß–®–ï–ù–ù–û–ï –°–†–ê–í–ù–ï–ù–ò–ï
 *
 * –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
 * 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç test/expect (testImportPath)
 * 2. –í apiErrorCodes —Ç–æ–ª—å–∫–æ 200-—ã–µ –∫–æ–¥—ã
 * 3. –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º
 * 4. –ó–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ catch —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
 * 5. –ü—Ä–∏–º–µ–Ω–µ–Ω—ã deepCompareObjects, generateTypeValidationCode, findDtoForEndpoint
 * 6. generateTypeValidationCode –Ω–∞ –æ—Å–Ω–æ–≤–µ DTO
 * 7. normalizeDbDataByDto –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–æ–≤ –∏–∑ DTO
 * 8. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω mergeDuplicateTests (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è endpoint)
 * 9. createSeparateDataFiles - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ –≤–Ω–µ—à–Ω–µ–º —Ñ–∞–π–ª–µ
 * 10. –ò–º–ø–æ—Ä—Ç DTO –≤ —Ç–µ—Å—Ç
 * 11. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç compareDbWithResponse –∏–∑ NPM –ø–∞–∫–µ—Ç–∞ (packageName)
 * 12. –†–µ–∞–ª—å–Ω—ã–π endpoint —Å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ ID –≤–º–µ—Å—Ç–æ {id}
 * 13. –£–ª—É—á—à–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–∞–∑–ª–∏—á–∏–π —Å —Ü–≤–µ—Ç–∞–º–∏ (–±–ª–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)
 * 14. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ (–ò–¥–µ—è 1 + 2)
 * 15. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–°—Ç—Ä–∞—Ç–µ–≥–∏—è 1 - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏)
 * 16. v14.2: –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤ (uniqueFields, uniqueFieldsUpperCase)
 *     - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è 400 "–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
 *     - –û—Ç–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (response === request)
 *     - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
 *     - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CAPS –ø–æ–ª–µ–π (code ‚Üí CODE_SUFFIX)
 * 17. –ù–û–í–û–ï v14.3: –¢–µ—Å—Ç—ã –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é (422 –æ—à–∏–±–∫–∏)
 *     - –°–±–æ—Ä 422 –æ—Ç–≤–µ—Ç–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤–æ –≤—Ä–µ–º—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
 *     - –ü—Ä–æ–ø—É—Å–∫ "Bad Request" –±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π JSON)
 *     - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–∞–ø–∫—É —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ç–∞—Ç—É—Å–∞ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
 *     - –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–ø–∫–µ test-data (–∫–∞–∫ Happy Path)
 * 18. –ù–û–í–û–ï v14.4: –¢–µ—Å—Ç—ã –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (400 –æ—à–∏–±–∫–∏)
 *     - –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç: –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí 400 + –ø—Ä–æ–≤–µ—Ä–∫–∞ –¢–û–ß–ù–û–ì–û —Å–æ–æ–±—â–µ–Ω–∏—è
 *     - –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.5: –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã —É–±—Ä–∞–Ω—ã (–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã)
 *     - 3 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø–∞–ø–∫–∏: happy-path, validation-tests (422), negative-400
 *     - –°–æ–æ–±—â–µ–Ω–∏–µ –±–µ—Ä—ë—Ç—Å—è –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ response (–Ω–µ —Ö–∞—Ä–¥–∫–æ–¥!)
 * 19. –ù–û–í–û–ï v14.5.6: Pattern matching –¥–ª—è excludeEndpoints
 *     - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ wildcard (*) –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –ø—É—Ç–∏
 *     - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ path –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–∏–ø–∞ {id}, {param}
 *     - –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ –æ–¥–Ω–æ–º –ø—É—Ç–∏
 * 20. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.7: –ú–∞—Å—Å–∏–≤—ã –≤ request body
 *     - –ú–∞—Å—Å–∏–≤ [324234] –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç {"0": 324234}
 *     - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–ø–∏—è –¥–∞–Ω–Ω—ã—Ö: Array.isArray –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ spread
 *     - prepareUniqueFields –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
 * 21. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.8: –£–¥–∞–ª–µ–Ω–∏–µ Content-Length –∏–∑ axios –∑–∞–ø—Ä–æ—Å–æ–≤
 *     - Content-Length –≤—ã–∑—ã–≤–∞–µ—Ç 502 –æ—à–∏–±–∫–∏ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±–µ–∫–µ–Ω–¥–∞—Ö
 *     - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è getAxiosConfigWithoutContentLength
 *     - transformRequest —É–¥–∞–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
 * 22. –ù–û–í–û–ï v14.5.9: –£–º–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π + —É–ª—É—á—à–µ–Ω–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
 *     - –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è (AUTOCODE ‚Üí XKZPQWNM), –ù–ï —Å—É—Ñ—Ñ–∏–∫—Å
 *     - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞: uppercase, lowercase, —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
 *     - ignoreFieldValues —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø—É—Ç–∏ (meta.count)
 *     - –£–ª—É—á—à–µ–Ω–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ –ø–æ—Ö–æ–∂–µ—Å—Ç–∏
 *     - –£–º–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —Ä–∞–∑–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
 */

import * as fs from 'fs';
import * as path from 'path';
import { findDtoForEndpoint, generateDtoValidationCode, DTOInfo } from './utils/dto-finder';
import { generateTypeValidationCode } from './utils/type-validator';
import {
  compareDbWithResponse,
  normalizeDbData,
  normalizeDbDataByDto
} from './utils/data-comparison';
import { deduplicateTests } from './utils/test-deduplication';
import { validateRequests, Validation422Error, Duplicate400Error } from './utils/data-validation';
import { generateErrorEmailHtml, ErrorNotificationData } from './utils/error-notification';
import { generateTestHelpersCode, TestHelpersConfig } from './utils/test-helpers-generator';
import axios from 'axios';

export interface HappyPathTestConfig {
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –û–°–ù–û–í–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –ü–∞–ø–∫–∞ –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
   * @example './e2e/api/happy-path'
   */
  outputDir: string;

  /**
   * –ù–û–í–û–ï v14.0: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≤ –ø–æ–¥–ø–∞–ø–∫–∏
   * –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ –ø—É—Ç–∏ endpoint: /api/v1/orders/place -> orders/
   * –ï—Å–ª–∏ true - —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç –ª–µ–∂–∞—Ç—å –≤ outputDir/orders/, outputDir/users/ –∏ —Ç.–¥.
   * @default true
   */
  groupByCategory?: boolean;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö –ë–ê–ó–ê–ú –î–ê–ù–ù–´–•
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * @deprecated –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ dbDataConnection –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ
   * –ò–º—è –º–µ—Ç–æ–¥–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
   */
  dbConnectionMethod?: string;

  /**
   * –ù–û–í–û–ï v14.0: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–æ–±—Ä–∞–Ω–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã
   * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —á—Ç–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã api_requests –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–µ—Å—Ç—ã
   *
   * @example
   * // –í –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:
   * import postgres from 'postgres';
   * export const sqlDataGenConn = postgres({ host: 'data-gen-db.example.com', ... });
   *
   * // –í –∫–æ–Ω—Ñ–∏–≥–µ:
   * dbDataConnection: sqlDataGenConn
   */
  dbDataConnection?: any;

  /**
   * –ù–û–í–û–ï v14.0: –°—Ö–µ–º–∞ –ë–î –¥–ª—è api_requests (–≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
   * @default 'qa'
   * @example 'qa' -> —Ç–∞–±–ª–∏—Ü–∞ qa.api_requests
   */
  dbDataSchema?: string;

  /**
   * –ù–û–í–û–ï v14.0: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞
   * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö - –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î —Å—Ç–µ–Ω–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã
   * –≠—Ç–æ –î–†–£–ì–ê–Ø –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –æ—Ç–ª–∏—á–Ω–∞—è –æ—Ç dbDataConnection
   *
   * @example
   * // –í –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:
   * import postgres from 'postgres';
   * export const sqlStandConn = postgres({ host: 'test-stand-db.example.com', ... });
   *
   * // –í –∫–æ–Ω—Ñ–∏–≥–µ:
   * dbStandConnection: sqlStandConn
   */
  dbStandConnection?: any;

  /**
   * –ù–û–í–û–ï v14.0: –°—Ö–µ–º–∞ –ë–î —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   * @default 'public'
   * @example 'orders' -> —Ç–∞–±–ª–∏—Ü—ã orders.*, users.* –∏ —Ç.–¥.
   */
  dbStandSchema?: string;

  /**
   * @deprecated –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ dbDataSchema –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ
   */
  dbSchema?: string;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –§–ò–õ–¨–¢–†–´ –≠–ù–î–ü–û–ò–ù–¢–û–í –ò –ú–ï–¢–û–î–û–í
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¢–û–õ–¨–ö–û –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (–±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫)
   * –ï—Å–ª–∏ –ø—É—Å—Ç–æ–π - –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
   * @example ['/api/v1/orders', '/api/v1/users']
   */
  endpointFilter?: string[];

  /**
   * –ù–û–í–û–ï v14.0: –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (—á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫)
   * –ò—Å–∫–ª—é—á–∞–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ endpointFilter
   * @example ['/api/v1/internal', '/api/v1/admin', '/api/v1/debug']
   */
  excludeEndpoints?: string[];

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¢–û–õ–¨–ö–û –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö HTTP –º–µ—Ç–æ–¥–æ–≤ (–±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫)
   * @example ['GET', 'POST'] - —Ç–æ–ª—å–∫–æ GET –∏ POST –∑–∞–ø—Ä–æ—Å—ã
   */
  methodFilter?: string[];

  /**
   * –ù–û–í–û–ï v14.0: –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö HTTP –º–µ—Ç–æ–¥–æ–≤ (—á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫)
   * @example ['DELETE', 'PATCH'] - –∏—Å–∫–ª—é—á–∏—Ç—å DELETE –∏ PATCH –∏–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   */
  excludeMethods?: string[];

  /**
   * –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç
   * @default 5
   */
  maxTestsPerEndpoint?: number;

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (2xx)
   * @default true
   */
  onlySuccessful?: boolean;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ù–ê–°–¢–†–û–ô–ö–ò –¢–ï–°–¢–û–í
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –¢–µ–≥ –¥–ª—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
   * @default '@apiHappyPath'
   * @example '@apiHappyPath @smoke'
   */
  testTag?: string;

  /**
   * –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
   * @default false
   */
  force?: boolean;

  /**
   * –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å URL —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞
   * @default 'StandURL'
   * @example 'TEST_STAND_URL' -> process.env.TEST_STAND_URL
   */
  standUrlEnvVar?: string;

  /**
   * –ò–º—è –∫–æ–Ω—Ñ–∏–≥–∞ axios –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ axiosConfigPath)
   * @default 'configApiHeaderAdmin'
   * @example 'configApiHeaderAdmin' -> { headers: { Authorization: 'Bearer ...' } }
   */
  axiosConfigName?: string;

  /**
   * –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å axios –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞)
   * @default '../../../helpers/axiosHelpers'
   */
  axiosConfigPath?: string;

  /**
   * –ù–û–í–û–ï v14.0: –ü—É—Ç—å –∫ apiTestHelper –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫
   * –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ –≤—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π response —Å –≥–æ—Ç–æ–≤—ã–º curl –∑–∞–ø—Ä–æ—Å–æ–º
   * @default '../../../helpers/apiTestHelper'
   * @example '../../../helpers/apiTestHelper' -> import { getMessageFromError } from '...'
   */
  apiTestHelperPath?: string;

  /**
   * –ù–û–í–û–ï v14.1: –ü—É—Ç—å –∫ –º–µ—Ç–æ–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∏ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ 5xx –æ—à–∏–±–∫–∞—Ö
   * –ú–µ—Ç–æ–¥ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTML-—Å—Ç—Ä–æ–∫—É —Å —Ç–µ–ª–æ–º –ø–∏—Å—å–º–∞
   *
   * @example '../../../helpers/mailHelper' -> import { sendErrorMailbyApi } from '...'
   */
  emailHelperPath?: string;

  /**
   * –ù–û–í–û–ï v14.1: –ò–º—è –º–µ—Ç–æ–¥–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email (—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ emailHelperPath)
   * @default 'sendErrorMailbyApi'
   */
  emailHelperMethodName?: string;

  /**
   * –ù–û–í–û–ï v14.1: –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ 5xx –æ—à–∏–±–∫–∞—Ö (500, 501, 502, 503)
   * –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π emailHelperPath
   * @default false
   */
  send5xxEmailNotification?: boolean;

  /**
   * –ü—É—Ç—å –∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º API –º–µ—Ç–æ–¥–∞–º (–¥–ª—è –ø–æ–∏—Å–∫–∞ DTO)
   * @example './src/generated-api'
   */
  apiGeneratedPath?: string;

  /**
   * –°–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   * –ï—Å–ª–∏ true - –¥–∞–Ω–Ω—ã–µ –≤—ã–Ω–æ—Å—è—Ç—Å—è –≤ –ø–∞–ø–∫—É test-data/
   * @default false
   */
  createSeparateDataFiles?: boolean;

  /**
   * –û–±—ä–µ–¥–∏–Ω—è—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
   * @default true
   */
  mergeDuplicateTests?: boolean;

  /**
   * –ü—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ test –∏ expect (—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
   * @default '@playwright/test'
   * @example '../../../fixtures/baseTest' - –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö fixtures
   */
  testImportPath?: string;

  /**
   * –ù–∞–∑–≤–∞–Ω–∏–µ NPM –ø–∞–∫–µ—Ç–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —É—Ç–∏–ª–∏—Ç (compareDbWithResponse –∏ —Ç.–¥.)
   * @default –ß–∏—Ç–∞–µ—Ç—Å—è –∏–∑ package.json –∏–ª–∏ '@your-company/api-codegen'
   */
  packageName?: string;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–Ø –¢–ï–°–¢–û–í (v12.0)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  /**
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
   *
   * –ó–ê–ß–ï–ú –≠–¢–û –ù–£–ñ–ù–û:
   * –ü—Ä–∏ —Å–±–æ—Ä–µ API –∑–∞–ø—Ä–æ—Å–æ–≤ —á–∞—Å—Ç–æ –ø–æ–ª—É—á–∞–µ–º –º–Ω–æ–≥–æ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –æ–¥–Ω–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É.
   * –ù–∞–ø—Ä–∏–º–µ—Ä, 100 –∑–∞–ø—Ä–æ—Å–æ–≤ GET /api/v1/orders/{id} —Å —Ä–∞–∑–Ω—ã–º–∏ id.
   * –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 100 —Ç–µ—Å—Ç–æ–≤ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ 2-3 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è.
   *
   * –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:
   * 1. –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É –∏ –º–µ—Ç–æ–¥—É
   * 2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É response (–∏–≥–Ω–æ—Ä–∏—Ä—É—è id, timestamps)
   * 3. –í—ã–±–∏—Ä–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏ (—Ä–∞–∑–Ω—ã–µ status, type, –ø—É—Å—Ç—ã–µ –º–∞—Å—Å–∏–≤—ã)
   * 4. –û—Å—Ç–∞–≤–ª—è–µ—Ç –º–∞–∫—Å–∏–º—É–º maxTestsPerEndpoint —Ç–µ—Å—Ç–æ–≤
   */
  deduplication?: {
    /**
     * –í–∫–ª—é—á–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é
     * @default true
     */
    enabled?: boolean;

    /**
     * –ü–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –ò–ì–ù–û–†–ò–†–£–Æ–¢–°–Ø –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
     * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç wildcard: '*_id' –º–∞—Ç—á–∏—Ç 'user_id', 'order_id' –∏ —Ç.–¥.
     * @default ['id', '*_id', 'created_at', 'updated_at', 'modified_at', 'deleted_at', 'timestamp', '*_timestamp', 'uuid', 'guid']
     *
     * –ü–†–ò–ú–ï–†: –î–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ id —Å—á–∏—Ç–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏:
     * { id: 1, status: 'active' } == { id: 2, status: 'active' }
     */
    ignoreFields?: string[];

    /**
     * –ü–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –í–ê–ñ–ù–´ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
     * –ï—Å–ª–∏ —ç—Ç–∏ –ø–æ–ª—è –æ—Ç–ª–∏—á–∞—é—Ç—Å—è - –∑–∞–ø—Ä–æ—Å—ã —Å—á–∏—Ç–∞—é—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏
     * @default ['status', 'state', 'type', 'role', 'category', 'kind']
     *
     * –ü–†–ò–ú–ï–†: –î–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å —Ä–∞–∑–Ω—ã–º status - —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã:
     * { status: 'active' } != { status: 'deleted' }
     */
    significantFields?: string[];

    /**
     * –û–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å edge cases (–≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏)
     * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª—è–µ—Ç —Ç–µ—Å—Ç—ã —Å: –ø—É—Å—Ç—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏, null, 0, –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏
     * @default true
     *
     * –ü–†–ò–ú–ï–†: –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å items: [] –∏ items: [...] - –æ–±–∞ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
     */
    detectEdgeCases?: boolean;

    /**
     * –ú–∞–∫—Å–∏–º—É–º —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç (–ø–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏)
     * @default 2
     */
    maxTestsPerEndpoint?: number;

    /**
     * –¢–µ–≥–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Ç–µ—Å—Ç–∞ –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
     * –¢–µ—Å—Ç—ã —Å —ç—Ç–∏–º–∏ —Ç–µ–≥–∞–º–∏ –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
     * @default ['[KEEP]', '[IMPORTANT]']
     *
     * –ü–†–ò–ú–ï–†: test('GET /orders [KEEP] - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π', ...) - –Ω–µ —É–¥–∞–ª–∏—Ç—Å—è
     */
    preserveTaggedTests?: string[];
  };

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –í–ê–õ–ò–î–ê–¶–ò–Ø –î–ê–ù–ù–´–• (v12.0)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  /**
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
   *
   * –ó–ê–ß–ï–ú –≠–¢–û –ù–£–ñ–ù–û:
   * –°–æ–±—Ä–∞–Ω–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç —É—Å—Ç–∞—Ä–µ—Ç—å - –¥–∞–Ω–Ω—ã–µ –≤ –ë–î —Å—Ç–µ–Ω–¥–∞ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å.
   * –ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–∫–∞–∑ –±—ã–ª –≤ —Å—Ç–∞—Ç—É—Å–µ 'pending', –∞ —Ç–µ–ø–µ—Ä—å 'completed'.
   * –¢–µ—Å—Ç —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º 'pending' –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å.
   *
   * –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:
   * 1. –ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–µ–Ω–¥
   * 2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º –≤ api_requests
   * 3. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å - –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é (update/skip/delete)
   */
  dataValidation?: {
    /**
     * –í–∫–ª—é—á–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
     * @default true
     */
    enabled?: boolean;

    /**
     * –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ü–ï–†–ï–î –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Ç–µ—Å—Ç–∞
     * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º response
     * @default true
     */
    validateBeforeGeneration?: boolean;

    /**
     * –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
     * - 'update': –û–±–Ω–æ–≤–∏—Ç—å response –≤ api_requests –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
     * - 'skip': –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ—Å—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
     * - 'delete': –£–¥–∞–ª–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–∑ api_requests
     * @default 'delete'
     */
    onStaleData?: 'update' | 'skip' | 'delete';

    /**
     * –ü–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏
     * –ï—Å–ª–∏ —ç—Ç–∏ –ø–æ–ª—è –∏–∑–º–µ–Ω–∏–ª–∏—Å—å - –¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏
     * @default ['status', 'state', 'type', 'role', 'category']
     *
     * –ü–†–ò–ú–ï–†: –ï—Å–ª–∏ status –∏–∑–º–µ–Ω–∏–ª—Å—è —Å 'pending' –Ω–∞ 'completed' - –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏
     */
    staleIfChanged?: string[];

    /**
     * –ò–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞–∫–∏—Ö –ø–æ–ª–µ–π –î–û–ü–£–°–¢–ò–ú–´ (–Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–µ–º)
     * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç wildcard: '*_at' –º–∞—Ç—á–∏—Ç 'created_at', 'updated_at'
     * @default ['updated_at', 'modified_at', '*_timestamp', '*_at']
     *
     * –ü–†–ò–ú–ï–†: –ò–∑–º–µ–Ω–µ–Ω–∏–µ updated_at –Ω–µ –¥–µ–ª–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏
     */
    allowChanges?: string[];

    /**
     * –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞
     * –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π dbStandConnection
     * @default false
     */
    validateInDatabase?: boolean;

    /**
     * –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
     * @default true
     */
    logChanges?: boolean;

    /**
     * –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
     * @default './happy-path-validation-logs'
     */
    logPath?: string;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –ù–û–í–û–ï v14.1: –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –û–®–ò–ë–û–ö –í–ê–õ–ò–î–ê–¶–ò–ò
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    /**
     * –ù–û–í–û–ï v14.1: –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è 4xx –æ—à–∏–±–æ–∫
     * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—à–∏–±–∫–∏ 400, 404, 422 –∏ –ø–æ–¥–æ–±–Ω—ã–µ –≤ —á–∏—Ç–∞–µ–º–æ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ
     * @example './validation-errors/client-errors.json'
     */
    clientErrorsLogPath?: string;

    /**
     * –ù–û–í–û–ï v14.1: –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è 5xx –æ—à–∏–±–æ–∫
     * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—à–∏–±–∫–∏ 500, 501, 502, 503 –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
     * @example './validation-errors/server-errors.json'
     */
    serverErrorsLogPath?: string;

    /**
     * –ù–û–í–û–ï v14.1: –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ 5xx –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏
     * –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π emailHelperPath –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–Ω—Ñ–∏–≥–µ
     * @default false
     */
    sendServerErrorEmail?: boolean;

    /**
     * –ù–û–í–û–ï v14.5.4: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ endpoint –¥–ª—è POST/PUT/PATCH
     * –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤—ã–∑–æ–≤ –≤–µ—Ä–Ω—ë—Ç 400/422 - –∑–∞–ø—Ä–æ—Å —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º
     * –ü–æ–ª–µ–∑–Ω–æ –∫–æ–≥–¥–∞ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–∏–Ω–æ–≥–¥–∞ 201, –∏–Ω–æ–≥–¥–∞ 400)
     * @default 1 (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤)
     * @example 3 - –≤—ã–∑–≤–∞—Ç—å 3 —Ä–∞–∑–∞, –µ—Å–ª–∏ —Ö–æ—Ç—å —Ä–∞–∑ –≤–µ—Ä–Ω—ë—Ç 400/422 - –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ happy path
     */
    validationRetries?: number;
  };

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –û–¢–õ–ê–î–ö–ê
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   * @default false
   */
  debug?: boolean;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ù–û–í–û–ï v14.2: –£–ù–ò–ö–ê–õ–¨–ù–´–ï –ü–û–õ–Ø –î–õ–Ø POST –ó–ê–ü–†–û–°–û–í
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –ù–û–í–û–ï v14.2: –ü–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏ POST/PUT/PATCH –∑–∞–ø—Ä–æ—Å–∞—Ö
   *
   * –ó–ê–ß–ï–ú –≠–¢–û –ù–£–ñ–ù–û:
   * –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–µ–π —á–∞—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ 400 "–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" –∏–∑-–∑–∞
   * –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (code, name, title –∏ —Ç.–¥.)
   *
   * –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:
   * 1. –ö –∑–Ω–∞—á–µ–Ω–∏—è–º —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—É—Ñ—Ñ–∏–∫—Å (timestamp + random)
   * 2. –°—É—Ñ—Ñ–∏–∫—Å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø–æ–ª–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ requestBody –∏ –∏–º–µ–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
   * 3. –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è POST, PUT, PATCH –∑–∞–ø—Ä–æ—Å–æ–≤
   *
   * @example ['name', 'code', 'title', 'email']
   * @default ['name', 'code', 'title']
   *
   * –ü–†–ò–ú–ï–†:
   * –ò—Å—Ö–æ–¥–Ω—ã–π request: { "name": "test", "code": "TEST", "title": "–¢–µ—Å—Ç" }
   * –ü–æ—Å–ª–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏: { "name": "test_1707654321_abc12", "code": "TEST_1707654321_abc12", "title": "–¢–µ—Å—Ç_1707654321_abc12" }
   */
  uniqueFields?: string[];

  /**
   * –ù–û–í–û–ï v14.2: –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
   * –ï—Å–ª–∏ false - –ø–æ–ª—è –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å –∏–∑ api_requests)
   * @default true
   */
  enableUniqueFieldGeneration?: boolean;

  /**
   * –ù–û–í–û–ï v14.2: –ü–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –í–ï–†–•–ù–ï–ú –†–ï–ì–ò–°–¢–†–ï (CAPS)
   * –°—É—Ñ—Ñ–∏–∫—Å –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∏ –∑–∞—Ç–µ–º –≤—Å—è —Å—Ç—Ä–æ–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ uppercase
   *
   * @example ['code', 'sku']
   * @default ['code']
   *
   * –ü–†–ò–ú–ï–†:
   * –ò—Å—Ö–æ–¥–Ω—ã–π: { "code": "TEST" }
   * –†–µ–∑—É–ª—å—Ç–∞—Ç: { "code": "TEST_1707654321_ABC12" } (–≤–µ—Å—å —Å—É—Ñ—Ñ–∏–∫—Å —Ç–æ–∂–µ –≤ CAPS)
   */
  uniqueFieldsUpperCase?: string[];

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ù–û–í–û–ï v14.5.4: –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–†–ê–í–ù–ï–ù–ò–ï–ú –ü–û–õ–ï–ô –í RESPONSE
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –ù–û–í–û–ï v14.5.4: –ü–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –ü–û–õ–ù–û–°–¢–¨–Æ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ response
   * –≠—Ç–∏ –ø–æ–ª—è –Ω–µ –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –≤–æ–æ–±—â–µ (–Ω–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, –Ω–∏ –∑–Ω–∞—á–µ–Ω–∏–µ)
   *
   * –ó–ê–ß–ï–ú –≠–¢–û –ù–£–ñ–ù–û:
   * –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –º–µ–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Ç–µ—Å—Ç–∞ –∏ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º:
   * - id (—Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å –Ω–æ–≤—ã–º id)
   * - count/total (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∏–∑–º–µ–Ω–∏–ª–æ—Å—å)
   * - created_at/updated_at (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏)
   *
   * @example ['id', 'count', 'total', 'created_at', 'updated_at']
   * @default ['id', 'created_at', 'updated_at', 'createdAt', 'updatedAt']
   */
  skipCompareFields?: string[];

  /**
   * –ù–û–í–û–ï v14.5.4: –ü–æ–ª—è –≥–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –°–£–©–ï–°–¢–í–û–í–ê–ù–ò–ï, –Ω–æ –ù–ï –∑–Ω–∞—á–µ–Ω–∏–µ
   * –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç —á—Ç–æ –ø–æ–ª–µ –µ—Å—Ç—å –≤ response, –Ω–æ –Ω–µ –±—É–¥–µ—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
   *
   * –ó–ê–ß–ï–ú –≠–¢–û –ù–£–ñ–ù–û:
   * –ò–Ω–æ–≥–¥–∞ –≤–∞–∂–Ω–æ —á—Ç–æ –ø–æ–ª–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ, –Ω–æ –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è:
   * - token (–∫–∞–∂–¥—ã–π —Ä–∞–∑ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π)
   * - session_id (—É–Ω–∏–∫–∞–ª–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
   * - request_id (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
   *
   * @example ['token', 'session_id', 'request_id']
   * @default []
   */
  ignoreFieldValues?: string[];

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ù–û–í–û–ï v14.3: –¢–ï–°–¢–´ –ù–ê –í–ê–õ–ò–î–ê–¶–ò–Æ (422 –û–®–ò–ë–ö–ò)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –ù–û–í–û–ï v14.3: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è 422 –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   *
   * –ó–ê–ß–ï–ú –≠–¢–û –ù–£–ñ–ù–û:
   * –ü—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 422 —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ.
   * –≠—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∞–∂–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ –±—ç–∫–µ–Ω–¥
   * –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
   *
   * –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:
   * 1. –ü—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ 422 –æ—Ç–≤–µ—Ç—ã —Å –Ω–µ–ø—É—Å—Ç—ã–º detail —Å–æ–æ–±—â–µ–Ω–∏–µ–º
   * 2. –ó–∞–ø—Ä–æ—Å—ã —Å "Bad Request" –±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
   * 3. –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–µ—Å—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–∞–ø–∫—É —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π: 422 —Å—Ç–∞—Ç—É—Å + –æ–∂–∏–¥–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   * 4. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤—ã–Ω–æ—Å—è—Ç—Å—è –≤ –ø–∞–ø–∫—É test-data (–∫–∞–∫ –≤ Happy Path)
   */
  validationTests?: {
    /**
     * –í–∫–ª—é—á–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ—Å—Ç–æ–≤ –Ω–∞ 422 –æ—à–∏–±–∫–∏
     * @default false
     */
    enabled?: boolean;

    /**
     * –ü–∞–ø–∫–∞ –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ outputDir)
     * @default '../validation-tests'
     * @example '../validation-tests' -> –µ—Å–ª–∏ outputDir='./e2e/happy-path', —Ç–æ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç –≤ './e2e/validation-tests'
     */
    outputDir?: string;

    /**
     * –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö "Bad Request" –æ—Ç–≤–µ—Ç–æ–≤
     * –°—é–¥–∞ –ø–æ–ø–∞–¥–∞—é—Ç 422 –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ "Bad Request")
     * @default './validation-errors/422-bad-request-skipped.json'
     */
    badRequestSkipLogPath?: string;

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–∫–∞–∫ –≤ Happy Path)
     * @default true
     */
    createSeparateDataFiles?: boolean;

    /**
     * –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≤ –ø–æ–¥–ø–∞–ø–∫–∏ (–∫–∞–∫ –≤ Happy Path)
     * @default true
     */
    groupByCategory?: boolean;

    /**
     * –¢–µ–≥ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é
     * @default '@apiValidation'
     */
    testTag?: string;

    /**
     * –ú–∞–∫—Å–∏–º—É–º —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç
     * @default 3
     */
    maxTestsPerEndpoint?: number;

    /**
     * –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ—Ç–æ—Ä—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è "–ø—É—Å—Ç—ã–º–∏" –∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
     * @default ['Bad Request', 'Validation failed', '']
     */
    skipMessagePatterns?: string[];

    /**
     * –ù–û–í–û–ï v14.5.2: –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å 422 –æ—Ç–≤–µ—Ç—ã —Å –ø—É—Å—Ç—ã–º response body
     * –ï—Å–ª–∏ true - –∑–∞–ø—Ä–æ—Å—ã –≥–¥–µ response –ø—É—Å—Ç–æ–π ({}, [], null) –Ω–µ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã
     * @default true
     */
    skipEmptyResponse?: boolean;
  };

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ù–û–í–û–ï v14.4: –¢–ï–°–¢–´ –ù–ê 400 –û–®–ò–ë–ö–ò (–î–£–ë–õ–ò–ö–ê–¢–´ / "–£–ñ–ï –°–£–©–ï–°–¢–í–£–ï–¢")
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –ù–û–í–û–ï v14.4: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è 400 –æ—à–∏–±–æ–∫ "–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
   *
   * –ó–ê–ß–ï–ú –≠–¢–û –ù–£–ñ–ù–û:
   * –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–µ–π —Å –¥—É–±–ª–∏—Ä—É—é—â–∏–º–∏—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ –±—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400
   * —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º —Ç–∏–ø–∞ "–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç". –≠—Ç–∏ —Ç–µ—Å—Ç—ã –≤–∞–∂–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
   *
   * –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:
   * 1. –ü—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ 400 –æ—Ç–≤–µ—Ç—ã —Å –Ω–µ–ø—É—Å—Ç—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
   * 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ endpoint –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç:
   *    - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí 400 + –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ response
   * 3. –°–æ–æ–±—â–µ–Ω–∏–µ –±–µ—Ä—ë—Ç—Å—è –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ response (–Ω–µ —Ö–∞—Ä–¥–∫–æ–¥!)
   * –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.5: –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã —É–±—Ä–∞–Ω—ã –∫–∞–∫ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ
   */
  duplicateTests?: {
    /**
     * –í–∫–ª—é—á–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ—Å—Ç–æ–≤ –Ω–∞ 400 –æ—à–∏–±–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
     * @default false
     */
    enabled?: boolean;

    /**
     * –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ 400 –¥—É–±–ª–∏–∫–∞—Ç—ã
     * @example './tests/api/negative-400'
     */
    outputDir?: string;

    /**
     * –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö "Bad Request" (400 –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è)
     * @default './validation-errors/400-bad-request-skipped.json'
     */
    badRequestSkipLogPath?: string;

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
     * @default true
     */
    createSeparateDataFiles?: boolean;

    /**
     * –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≤ –ø–æ–¥–ø–∞–ø–∫–∏
     * @default true
     */
    groupByCategory?: boolean;

    /**
     * –¢–µ–≥ –¥–ª—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (400)
     * @default '@negative400Validation'
     */
    testTag?: string;

    /**
     * –ú–∞–∫—Å–∏–º—É–º —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç
     * @default 2
     */
    maxTestsPerEndpoint?: number;

    /**
     * –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ—Ç–æ—Ä—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è "–ø—É—Å—Ç—ã–º–∏" –∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
     * @default ['Bad Request', '']
     */
    skipMessagePatterns?: string[];

    /**
     * –ù–û–í–û–ï v14.5.2: –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å 400 –æ—Ç–≤–µ—Ç—ã —Å –ø—É—Å—Ç—ã–º response body
     * –ï—Å–ª–∏ true - –∑–∞–ø—Ä–æ—Å—ã –≥–¥–µ response –ø—É—Å—Ç–æ–π ({}, [], null) –Ω–µ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã
     * @default true
     */
    skipEmptyResponse?: boolean;
  };
}

interface UniqueRequest {
  id: number;
  endpoint: string;
  method: string;
  request_body: any;
  response_body: any;
  response_status: number;
  test_name: string;
  test_generated?: boolean;
  test_file_path?: string;
}

/**
 * –ù–û–í–û–ï v13.0: –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Ñ–∞–π–ª–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
 */
function findFileRecursively(
  dir: string,
  fileName: string,
  maxDepth: number = 5,
  currentDepth: number = 0
): string | null {
  if (currentDepth > maxDepth) return null;

  try {
    const items = fs.readdirSync(dir);

    for (const item of items) {
      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º node_modules, .git –∏ –¥—Ä—É–≥–∏–µ —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–∞–ø–∫–∏
      if (item === 'node_modules' || item === '.git' || item.startsWith('.')) {
        continue;
      }

      const fullPath = path.join(dir, item);

      try {
        const stat = fs.statSync(fullPath);

        if (stat.isFile()) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º—è —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ .ts/.js)
          const baseName = path.basename(item, path.extname(item));
          if (baseName === fileName || item === fileName || item === `${fileName}.ts` || item === `${fileName}.js`) {
            return fullPath;
          }
        } else if (stat.isDirectory()) {
          // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∏—â–µ–º –≤ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
          const found = findFileRecursively(fullPath, fileName, maxDepth, currentDepth + 1);
          if (found) return found;
        }
      } catch (err) {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–∞–π–ª—ã/–ø–∞–ø–∫–∏ –∫ –∫–æ—Ç–æ—Ä—ã–º –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
        continue;
      }
    }
  } catch (err) {
    return null;
  }

  return null;
}

/**
 * –ù–û–í–û–ï v13.0: –£–º–Ω—ã–π –ø–æ–∏—Å–∫ axios –∫–æ–Ω—Ñ–∏–≥–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
 */
async function findAndLoadAxiosConfig(
  configPath: string | undefined,
  configName: string,
  debug: boolean = false
): Promise<any | null> {
  const searchPaths: string[] = [];
  const cwd = process.cwd();

  if (debug) {
    console.log(`üêõ –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: ${cwd}`);
    console.log(`üêõ –ò—â–µ–º axios –∫–æ–Ω—Ñ–∏–≥: ${configName}`);
  }

  // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—É—Ç—å –∫–∞–∫ –µ—Å—Ç—å
  if (configPath) {
    searchPaths.push(configPath);

    // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ cwd
    const absolutePath = path.isAbsolute(configPath)
      ? configPath
      : path.join(cwd, configPath);
    searchPaths.push(absolutePath);

    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏
    searchPaths.push(absolutePath + '.ts');
    searchPaths.push(absolutePath + '.js');
  }

  // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
  const fileNameFromPath = configPath
    ? path.basename(configPath, path.extname(configPath))
    : 'axiosHelpers';

  if (debug) {
    console.log(`üêõ –ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞: ${fileNameFromPath}`);
    console.log(`üêõ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∏—Å–∫–∞:`);
    console.log(`   1. –£–∫–∞–∑–∞–Ω–Ω—ã–π –ø—É—Ç—å: ${configPath || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);
    console.log(`   2. –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ cwd: ${cwd}`);
    console.log(`   3. –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏: ${fileNameFromPath}`);
  }

  // –ü—Ä–æ–±—É–µ–º –∫–∞–∂–¥—ã–π –ø—É—Ç—å
  for (const searchPath of searchPaths) {
    if (debug) {
      console.log(`üêõ –ü—Ä–æ–±—É—é –ø—É—Ç—å: ${searchPath}`);
    }

    try {
      const module = await import(searchPath);
      if (module[configName]) {
        if (debug) {
          console.log(`‚úì –ù–∞–π–¥–µ–Ω –∫–æ–Ω—Ñ–∏–≥ –ø–æ –ø—É—Ç–∏: ${searchPath}`);
        }
        return module[configName];
      } else {
        if (debug) {
          console.log(`   ‚ö†Ô∏è  –§–∞–π–ª –Ω–∞–π–¥–µ–Ω, –Ω–æ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç '${configName}'`);
          console.log(`   –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã:`, Object.keys(module));
        }
      }
    } catch (error: any) {
      if (debug && !error.message.includes('Cannot find module')) {
        console.log(`   ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`);
      }
    }
  }

  // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 4: –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Ñ–∞–π–ª–∞
  if (debug) {
    console.log(`üêõ –ù–∞—á–∏–Ω–∞—é —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Ñ–∞–π–ª–∞ '${fileNameFromPath}' –≤ ${cwd}...`);
  }

  const foundPath = findFileRecursively(cwd, fileNameFromPath);

  if (foundPath) {
    if (debug) {
      console.log(`üêõ –§–∞–π–ª –Ω–∞–π–¥–µ–Ω: ${foundPath}`);
    }

    // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–≥—Ä—É–∑–∫–∏
    const pathsToTry: string[] = [foundPath];

    // –ï—Å–ª–∏ —ç—Ç–æ .ts —Ñ–∞–π–ª, –∏—â–µ–º —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é .js –≤–µ—Ä—Å–∏—é
    if (foundPath.endsWith('.ts')) {
      const jsPath = foundPath.replace(/\.ts$/, '.js');
      pathsToTry.push(jsPath);

      // –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –≤ dist/build –ø–∞–ø–∫–∞—Ö
      const dirName = path.dirname(foundPath);
      const baseName = path.basename(foundPath, '.ts');
      pathsToTry.push(path.join(dirName, '..', 'dist', baseName + '.js'));
      pathsToTry.push(path.join(dirName, '..', 'build', baseName + '.js'));
      pathsToTry.push(path.join(dirName, 'dist', baseName + '.js'));
    }

    for (const tryPath of pathsToTry) {
      if (!fs.existsSync(tryPath)) continue;

      if (debug) {
        console.log(`üêõ –ü—Ä–æ–±—É—é –∑–∞–≥—Ä—É–∑–∏—Ç—å: ${tryPath}`);
      }

      try {
        // –°–ø–æ—Å–æ–± 1: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π import —Å file:// –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º
        let module: any;

        try {
          // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç file:// URL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
          const fileUrl = new URL('file://' + (tryPath.startsWith('/') ? '' : '/') + tryPath.replace(/\\/g, '/')).href;
          if (debug) {
            console.log(`üêõ   –ü—Ä–æ–±—É—é import —Å URL: ${fileUrl}`);
          }
          module = await import(fileUrl);
        } catch (importError: any) {
          if (debug) {
            console.log(`üêõ   Import –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: ${importError.message}`);
          }

          // –°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑—É–µ–º require (–¥–ª—è CommonJS)
          try {
            if (debug) {
              console.log(`üêõ   –ü—Ä–æ–±—É—é require: ${tryPath}`);
            }
            // eslint-disable-next-line @typescript-eslint/no-var-requires
            module = require(tryPath);
          } catch (requireError: any) {
            if (debug) {
              console.log(`üêõ   Require –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: ${requireError.message}`);
            }
            continue;
          }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞
        if (module && module[configName]) {
          if (debug) {
            console.log(`‚úì –ö–æ–Ω—Ñ–∏–≥ '${configName}' –Ω–∞–π–¥–µ–Ω –≤ —Ñ–∞–π–ª–µ: ${tryPath}`);
          }
          return module[configName];
        } else if (module && module.default && module.default[configName]) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º default export
          if (debug) {
            console.log(`‚úì –ö–æ–Ω—Ñ–∏–≥ '${configName}' –Ω–∞–π–¥–µ–Ω –≤ default export —Ñ–∞–π–ª–∞: ${tryPath}`);
          }
          return module.default[configName];
        } else {
          if (debug) {
            const availableKeys = module ? Object.keys(module) : [];
            console.log(`‚ö†Ô∏è  –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç '${configName}'`);
            console.log(`   –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã:`, availableKeys);
            if (module?.default) {
              console.log(`   –≠–∫—Å–ø–æ—Ä—Ç—ã –≤ default:`, Object.keys(module.default));
            }
          }
        }
      } catch (error: any) {
        if (debug) {
          console.log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ${tryPath}: ${error.message}`);
        }
      }
    }
  } else {
    if (debug) {
      console.log(`‚ö†Ô∏è  –§–∞–π–ª '${fileNameFromPath}' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø—Ä–æ–µ–∫—Ç–µ`);
    }
  }

  return null;
}

/**
 * –ù–û–í–û–ï v14.0: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ –ø—É—Ç–∏ endpoint
 * /api/v1/orders/place -> orders
 * /api/v2/users/{id}/profile -> users
 * /api/v1/finance/reports/summary -> finance
 */
function getCategoryFromEndpoint(endpoint: string): string {
  // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ –ø—É—Ç–∏ –ø–æ—Å–ª–µ /api/v1/ –∏–ª–∏ /api/v2/
  // /api/v1/orders/place -> orders
  const versionedMatch = endpoint.match(/^\/api\/v\d+\/([^/]+)/);
  if (versionedMatch) {
    return versionedMatch[1].toLowerCase();
  }

  // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ –ø—É—Ç–∏ –ø–æ—Å–ª–µ /api/ (–±–µ–∑ –≤–µ—Ä—Å–∏–∏)
  // /api/orders/search -> orders
  const simpleMatch = endpoint.match(/^\/api\/([^/]+)/);
  if (simpleMatch && !simpleMatch[1].match(/^v\d+$/)) {
    return simpleMatch[1].toLowerCase();
  }

  // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: –ü–µ—Ä–≤—ã–π –∑–Ω–∞—á–∏–º—ã–π —Å–µ–≥–º–µ–Ω—Ç –ø—É—Ç–∏
  const segments = endpoint.split('/').filter(s => s && !s.match(/^(api|v\d+|\{[^}]+\})$/));
  if (segments.length > 0) {
    return segments[0].toLowerCase();
  }

  return 'other';
}

// –ù–û–í–û–ï v14.0: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω—É–∂–Ω–æ –ª–∏ –∏—Å–∫–ª—é—á–∏—Ç—å endpoint
// –û–ë–ù–û–í–õ–ï–ù–ò–ï v14.5.6: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å wildcard (*) –∏ path –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ ({id})
// –ü—Ä–∏–º–µ—Ä—ã: "/api/v1/orders", "/api/v1/orders/*", "/api/v1/order/*/create", "/api/v1/order/{id}/create"
function shouldExcludeEndpoint(endpoint: string, excludePatterns: string[]): boolean {
  if (!excludePatterns || excludePatterns.length === 0) return false;

  for (const pattern of excludePatterns) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω wildcard (*) –∏–ª–∏ path –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ({...})
    const hasWildcard = pattern.includes('*');
    const hasPathParam = /\{[^}]+\}/.test(pattern);

    if (hasWildcard || hasPathParam) {
      // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω –≤ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
      const regexPattern = patternToRegex(pattern);
      if (regexPattern.test(endpoint)) return true;
    } else {
      // –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–µ—Ñ–∏–∫—Å
      if (endpoint === pattern || endpoint.startsWith(pattern + '/')) {
        return true;
      }
    }
  }
  return false;
}

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω endpoint –≤ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
 * - * –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ [^/]+ (–ª—é–±–æ–π —Å–µ–≥–º–µ–Ω—Ç –ø—É—Ç–∏, –∫—Ä–æ–º–µ /)
 * - {param} –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ [^/]+ (–ª—é–±–æ–π —Å–µ–≥–º–µ–Ω—Ç –ø—É—Ç–∏)
 * - –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è
 */
function patternToRegex(pattern: string): RegExp {
  // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã regex, –∫—Ä–æ–º–µ * –∏ {}
  let regexStr = pattern
    .replace(/[.+?^${}()|[\]\\]/g, '\\$&') // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü. —Å–∏–º–≤–æ–ª—ã
    .replace(/\\\{[^}]+\\\}/g, '[^/]+')     // {param} -> [^/]+
    .replace(/\*/g, '[^/]+');               // * -> [^/]+

  // –î–æ–±–∞–≤–ª—è–µ–º —è–∫–æ—Ä—è –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤—Å–µ–≥–æ –ø—É—Ç–∏
  return new RegExp(`^${regexStr}$`);
}

/**
 * –ù–û–í–û–ï v14.0: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω—É–∂–Ω–æ –ª–∏ –∏—Å–∫–ª—é—á–∏—Ç—å HTTP –º–µ—Ç–æ–¥
 */
function shouldExcludeMethod(method: string, excludeMethods: string[]): boolean {
  if (!excludeMethods || excludeMethods.length === 0) return false;
  return excludeMethods.map(m => m.toUpperCase()).includes(method.toUpperCase());
}

export class HappyPathTestGenerator {
  private sql: any; // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Å api_requests (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
  private sqlStand: any; // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞ (–¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
  private config: Required<HappyPathTestConfig>;

  /**
   * @param config - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
   * @param sqlConnection - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –¥–ª—è –û–ë–†–ê–¢–ù–û–ô –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–ò
   *                        –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å config.dbDataConnection –∏ config.dbStandConnection
   */
  constructor(config: HappyPathTestConfig, sqlConnection?: any) {
    // –ß–∏—Ç–∞–µ–º package.json –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –ø–∞–∫–µ—Ç–∞
    let defaultPackageName = '@your-company/api-codegen';
    try {
      const packageJsonPath = path.join(__dirname, '../../package.json');
      if (fs.existsSync(packageJsonPath)) {
        const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));
        defaultPackageName = packageJson.name || defaultPackageName;
      }
    } catch (error) {
      console.warn('‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å package.json, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
    }

    this.config = {
      // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
      endpointFilter: [],
      methodFilter: [],
      excludeEndpoints: [], // –ù–û–í–û–ï v14.0
      excludeMethods: [], // –ù–û–í–û–ï v14.0
      maxTestsPerEndpoint: 5,
      onlySuccessful: true,
      testTag: '@apiHappyPath',
      force: false,
      groupByCategory: true, // –ù–û–í–û–ï v14.0: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

      // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
      dbSchema: 'qa', // deprecated
      dbDataSchema: 'qa', // –ù–û–í–û–ï v14.0
      dbStandSchema: 'public', // –ù–û–í–û–ï v14.0
      dbConnectionMethod: '', // deprecated
      dbDataConnection: undefined, // –ù–û–í–û–ï v14.0
      dbStandConnection: undefined, // –ù–û–í–û–ï v14.0

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤
      standUrlEnvVar: 'StandURL',
      axiosConfigName: 'configApiHeaderAdmin',
      axiosConfigPath: '../../../helpers/axiosHelpers',
      apiTestHelperPath: '../../../helpers/apiTestHelper', // –ù–û–í–û–ï v14.0
      emailHelperPath: '', // –ù–û–í–û–ï v14.1
      emailHelperMethodName: 'sendErrorMailbyApi', // –ù–û–í–û–ï v14.1
      send5xxEmailNotification: false, // –ù–û–í–û–ï v14.1
      apiGeneratedPath: '',
      createSeparateDataFiles: false,
      mergeDuplicateTests: true,
      testImportPath: '@playwright/test',
      packageName: defaultPackageName,
      debug: false,
      // –ù–û–í–û–ï v14.2: –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤
      uniqueFields: ['name', 'code', 'title'],
      uniqueFieldsUpperCase: ['code'],
      enableUniqueFieldGeneration: true,
      // –ù–û–í–û–ï v14.5.4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º –ø–æ–ª–µ–π –≤ response
      skipCompareFields: ['id', 'created_at', 'updated_at', 'createdAt', 'updatedAt'],
      ignoreFieldValues: [],
      ...config,

      // –ù–û–í–û–ï v12.0: –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
      deduplication: {
        enabled: true,
        ignoreFields: ['id', '*_id', 'created_at', 'updated_at', 'modified_at', 'deleted_at', 'timestamp', '*_timestamp', 'uuid', 'guid'],
        significantFields: ['status', 'state', 'type', 'role', 'category', 'kind'],
        detectEdgeCases: true,
        maxTestsPerEndpoint: 2, // –ú–∞–∫—Å–∏–º—É–º 2 —Ç–µ—Å—Ç–∞ –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç (–∫–∞–∫ —É–∫–∞–∑–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
        preserveTaggedTests: ['[KEEP]', '[IMPORTANT]'],
        ...(config.deduplication || {})
      },

      // –ù–û–í–û–ï v12.0: –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
      dataValidation: {
        enabled: true,
        validateBeforeGeneration: true,
        onStaleData: 'delete', // –£–¥–∞–ª—è–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ (–∫–∞–∫ —É–∫–∞–∑–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
        staleIfChanged: ['status', 'state', 'type', 'role', 'category'],
        allowChanges: ['updated_at', 'modified_at', '*_timestamp', '*_at'],
        validateInDatabase: false, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ (–Ω—É–∂–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
        logChanges: true,
        logPath: './happy-path-validation-logs',
        // –ù–û–í–û–ï v14.1: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        clientErrorsLogPath: './validation-errors/4xx-client-errors.json',
        serverErrorsLogPath: './validation-errors/5xx-server-errors.json',
        sendServerErrorEmail: false,
        // –ù–û–í–û–ï v14.5.4: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è POST/PUT/PATCH
        validationRetries: 1,
        ...(config.dataValidation || {})
      },

      // –ù–û–í–û–ï v14.3: –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é (422)
      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.1: –£–±—Ä–∞–Ω—ã –ø—É—Å—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∞
      validationTests: {
        enabled: false, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ
        outputDir: '../validation-tests',
        badRequestSkipLogPath: './validation-errors/422-bad-request-skipped.json',
        createSeparateDataFiles: true,
        groupByCategory: true,
        testTag: '@apiValidation',
        maxTestsPerEndpoint: 3,
        skipMessagePatterns: [], // –ü—É—Å—Ç–æ–π - —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫—Ä–æ–º–µ –ø—É—Å—Ç—ã—Ö
        ...(config.validationTests || {})
      },

      // –ù–û–í–û–ï v14.4: –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ 400 –¥—É–±–ª–∏–∫–∞—Ç—ã
      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.1: –£–±—Ä–∞–Ω—ã –ø—É—Å—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
      duplicateTests: {
        enabled: false, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ
        outputDir: './tests/api/negative-400',
        badRequestSkipLogPath: './validation-errors/400-bad-request-skipped.json',
        createSeparateDataFiles: true,
        groupByCategory: true,
        testTag: '@negative400Validation',
        maxTestsPerEndpoint: 2,
        skipMessagePatterns: [], // –ü—É—Å—Ç–æ–π - —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫—Ä–æ–º–µ –ø—É—Å—Ç—ã—Ö
        ...(config.duplicateTests || {})
      }
    };

    // –ù–û–í–û–ï v14.0: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: config.dbDataConnection > sqlConnection (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
    this.sql = config.dbDataConnection || sqlConnection;

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Å—Ç–µ–Ω–¥–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    this.sqlStand = config.dbStandConnection || null;

    if (!this.sql) {
      console.warn('‚ö†Ô∏è  –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ! –ü–µ—Ä–µ–¥–∞–π—Ç–µ sqlConnection –∏–ª–∏ config.dbDataConnection');
    }

    if (this.config.dataValidation.validateInDatabase && !this.sqlStand) {
      console.warn('‚ö†Ô∏è  validateInDatabase=true, –Ω–æ dbStandConnection –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
    }
  }

  /**
   * –ù–û–í–û–ï v14.1: –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
   */
  private async loadEmailSendFunction(): Promise<((html: string) => Promise<void>) | undefined> {
    if (!this.config.emailHelperPath || !this.config.send5xxEmailNotification) {
      return undefined;
    }

    try {
      const emailHelperPath = this.config.emailHelperPath;
      const methodName = this.config.emailHelperMethodName || 'sendErrorMailbyApi';

      // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å
      const possiblePaths = [
        path.resolve(process.cwd(), emailHelperPath),
        path.resolve(process.cwd(), emailHelperPath + '.ts'),
        path.resolve(process.cwd(), emailHelperPath + '.js'),
        path.resolve(process.cwd(), 'src', emailHelperPath),
        path.resolve(process.cwd(), 'src', emailHelperPath + '.ts')
      ];

      for (const tryPath of possiblePaths) {
        if (fs.existsSync(tryPath)) {
          try {
            const module = require(tryPath);
            if (module[methodName] && typeof module[methodName] === 'function') {
              if (this.config.debug) {
                console.log(`üêõ Email —Ñ—É–Ω–∫—Ü–∏—è '${methodName}' –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ ${tryPath}`);
              }
              return module[methodName];
            }
          } catch (e) {
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–∏—Å–∫
          }
        }
      }

      console.warn(`‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å email —Ñ—É–Ω–∫—Ü–∏—é '${methodName}' –∏–∑ '${emailHelperPath}'`);
      return undefined;

    } catch (error) {
      console.warn(`‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ email —Ñ—É–Ω–∫—Ü–∏–∏:`, error);
      return undefined;
    }
  }

  async generate(): Promise<void> {
    console.log('üîç –ü–æ–¥–∫–ª—é—á–∞—é—Å—å –∫ –ë–î –∏ —Å–æ–±–∏—Ä–∞—é –¥–∞–Ω–Ω—ã–µ...');
    console.log(this.config.force ? '‚ö†Ô∏è  FORCE —Ä–µ–∂–∏–º' : '‚ÑπÔ∏è  –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º');

    if (this.config.debug) {
      console.log('üêõ DEBUG MODE: –í–∫–ª—é—á–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥');
      console.log('üêõ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:', JSON.stringify({
        standUrlEnvVar: this.config.standUrlEnvVar,
        standUrl: process.env[this.config.standUrlEnvVar],
        axiosConfigName: this.config.axiosConfigName,
        axiosConfigPath: this.config.axiosConfigPath,
        dbSchema: this.config.dbSchema
      }, null, 2));
    }

    let uniqueRequests = await this.fetchUniqueRequests();
    console.log(`üìä –ù–∞–π–¥–µ–Ω–æ ${uniqueRequests.length} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤`);

    // –ù–û–í–û–ï v12.0: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏)
    if (this.config.dataValidation.enabled && this.config.dataValidation.validateBeforeGeneration) {
      try {
        // –ù–û–í–û–ï v13.0: –£–º–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ axios –∫–æ–Ω—Ñ–∏–≥–∞ —Å –∞–≤—Ç–æ–ø–æ–∏—Å–∫–æ–º
        let axiosConfigObject: any = undefined;

        if (this.config.axiosConfigName) {
          console.log(`\nüîç –ü–æ–∏—Å–∫ axios –∫–æ–Ω—Ñ–∏–≥–∞ '${this.config.axiosConfigName}'...`);

          const loadedAxiosConfig = await findAndLoadAxiosConfig(
            this.config.axiosConfigPath,
            this.config.axiosConfigName,
            this.config.debug
          );

          if (loadedAxiosConfig) {
            console.log(`‚úì Axios –∫–æ–Ω—Ñ–∏–≥ '${this.config.axiosConfigName}' –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ`);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º: —ç—Ç–æ axios instance –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏?
            const isAxiosInstance = typeof loadedAxiosConfig?.get === 'function';

            if (isAxiosInstance) {
              // –≠—Ç–æ axios instance - –∏–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–Ω—Ñ–∏–≥
              axiosConfigObject = loadedAxiosConfig.defaults;

              if (this.config.debug) {
                console.log(`üêõ –ó–∞–≥—Ä—É–∂–µ–Ω axios instance`);
                console.log(`üêõ –ö–æ–Ω—Ñ–∏–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç:`, {
                  hasHeaders: !!axiosConfigObject?.headers,
                  hasAuth: !!axiosConfigObject?.headers?.Authorization,
                  baseURL: axiosConfigObject?.baseURL
                });
              }
            } else {
              // –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
              axiosConfigObject = loadedAxiosConfig;

              if (this.config.debug) {
                console.log(`üêõ –ó–∞–≥—Ä—É–∂–µ–Ω –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏`);
                console.log(`üêõ –ö–æ–Ω—Ñ–∏–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç:`, {
                  hasHeaders: !!axiosConfigObject?.headers,
                  hasAuth: !!axiosConfigObject?.headers?.authorization || !!axiosConfigObject?.headers?.Authorization,
                  hasHttpsAgent: !!axiosConfigObject?.httpsAgent
                });
              }
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ debug —Ä–µ–∂–∏–º–µ
            if (this.config.debug && axiosConfigObject?.headers) {
              console.log(`üêõ –í—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:`, JSON.stringify(axiosConfigObject.headers, null, 2));
            }
          } else {
            console.warn(`‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ axios –∫–æ–Ω—Ñ–∏–≥ '${this.config.axiosConfigName}'`);
            console.warn(`‚ö†Ô∏è  –ü—Ä–æ–¥–æ–ª–∂–∞—é –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–º–æ–≥—É—Ç –±—ã—Ç—å 401 –æ—à–∏–±–∫–∏)`);
          }
        }

        // –ü–æ–ª—É—á–∞–µ–º URL —Å—Ç–µ–Ω–¥–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
        const standUrl = process.env[this.config.standUrlEnvVar];

        if (!standUrl) {
          console.warn(`‚ö†Ô∏è  –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è ${this.config.standUrlEnvVar} –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞`);
          if (this.config.debug) {
            console.log(`üêõ –î–æ—Å—Ç—É–ø–Ω—ã–µ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:`, Object.keys(process.env).filter(k => k.includes('URL')));
          }
        } else if (this.config.debug) {
          console.log(`üêõ Stand URL: ${standUrl}`);
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        // –ù–û–í–û–ï v14.0: –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ axios –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
        // –ù–û–í–û–ï v14.1: –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ email –¥–ª—è 5xx
        // –ù–û–í–û–ï v14.3: –î–æ–±–∞–≤–ª—è–µ–º —Å–±–æ—Ä 422 –æ—à–∏–±–æ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        const validationConfig = {
          ...this.config.dataValidation,
          standUrl: standUrl,
          axiosConfig: axiosConfigObject,
          // –ù–û–í–û–ï v14.1: –ü–µ—Ä–µ–¥–∞—ë–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ email –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
          emailSendFunction: this.config.send5xxEmailNotification && this.config.emailHelperPath
            ? await this.loadEmailSendFunction()
            : undefined,
          // –ù–û–í–û–ï v14.3: –°–±–æ—Ä 422 –æ—à–∏–±–æ–∫
          collect422Errors: this.config.validationTests.enabled,
          badRequestSkipLogPath: this.config.validationTests.badRequestSkipLogPath,
          skipMessagePatterns: this.config.validationTests.skipMessagePatterns,
          // –ù–û–í–û–ï v14.5.2: –ü—Ä–æ–ø—É—Å–∫ –ø—É—Å—Ç—ã—Ö response –¥–ª—è 422
          skipEmptyResponse422: this.config.validationTests.skipEmptyResponse !== false,
          // –ù–û–í–û–ï v14.4: –°–±–æ—Ä 400 –æ—à–∏–±–æ–∫ –¥–ª—è –ø–∞—Ä–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
          collect400Errors: this.config.duplicateTests.enabled,
          badRequest400SkipLogPath: this.config.duplicateTests.badRequestSkipLogPath,
          skip400MessagePatterns: this.config.duplicateTests.skipMessagePatterns,
          // –ù–û–í–û–ï v14.5.2: –ü—Ä–æ–ø—É—Å–∫ –ø—É—Å—Ç—ã—Ö response –¥–ª—è 400
          skipEmptyResponse400: this.config.duplicateTests.skipEmptyResponse !== false,
          // –ù–û–í–û–ï v14.6.1: –ü–æ–¥–º–µ–Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
          // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç 400 "—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ POST/PUT/PATCH
          uniqueFields: this.config.uniqueFields,
          uniqueFieldsUpperCase: this.config.uniqueFieldsUpperCase
        };

        if (this.config.debug) {
          console.log(`üêõ –ö–æ–Ω—Ñ–∏–≥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:`, {
            enabled: validationConfig.enabled,
            validateBeforeGeneration: validationConfig.validateBeforeGeneration,
            standUrl: validationConfig.standUrl,
            hasAxiosConfig: !!validationConfig.axiosConfig,
            hasAuthHeader: !!validationConfig.axiosConfig?.headers?.authorization || !!validationConfig.axiosConfig?.headers?.Authorization,
            clientErrorsLogPath: validationConfig.clientErrorsLogPath,
            serverErrorsLogPath: validationConfig.serverErrorsLogPath,
            sendServerErrorEmail: validationConfig.sendServerErrorEmail
          });
        }

        // –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º –Ω–∞—Å—Ç–æ—è—â–∏–π axios, –∞ –∫–æ–Ω—Ñ–∏–≥ - –æ—Ç–¥–µ–ª—å–Ω–æ –≤ validationConfig
        const validationResult = await validateRequests(
          uniqueRequests,
          validationConfig,
          axios  // ‚Üê –ù–∞—Å—Ç–æ—è—â–∏–π axios, –Ω–µ –∫–æ–Ω—Ñ–∏–≥!
        );

        uniqueRequests = validationResult.validRequests;

        console.log(`\n‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞:`);
        console.log(`   –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤: ${uniqueRequests.length}`);
        if (validationResult.updatedCount > 0) {
          console.log(`   –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${validationResult.updatedCount}`);
        }
        if (validationResult.deletedCount > 0) {
          console.log(`   –£–¥–∞–ª–µ–Ω–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö: ${validationResult.deletedCount}`);
        }
        if (validationResult.skippedCount > 0) {
          console.log(`   –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${validationResult.skippedCount}`);
        }

        // –ù–û–í–û–ï v14.3: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç—ã –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é (422 –æ—à–∏–±–∫–∏)
        if (this.config.debug || validationResult.validation422Errors.length > 0 || validationResult.duplicate400Errors.length > 0) {
          console.log(`\nüìã –°–æ–±—Ä–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤:`);
          console.log(`   422 –æ—à–∏–±–æ–∫: ${validationResult.validation422Errors.length} (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è: ${this.config.validationTests.enabled ? '–í–ö–õ' : '–í–´–ö–õ'})`);
          console.log(`   400 –æ—à–∏–±–æ–∫: ${validationResult.duplicate400Errors.length} (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è: ${this.config.duplicateTests.enabled ? '–í–ö–õ' : '–í–´–ö–õ'})`);
        }

        if (this.config.validationTests.enabled && validationResult.validation422Errors.length > 0) {
          await this.generateValidation422Tests(validationResult.validation422Errors);
        } else if (this.config.validationTests.enabled && validationResult.validation422Errors.length === 0) {
          console.log(`   ‚ö†Ô∏è  422 —Ç–µ—Å—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã, –Ω–æ –æ—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`);
        }

        // –ù–û–í–û–ï v14.4: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (400 –æ—à–∏–±–∫–∏)
        if (this.config.duplicateTests.enabled && validationResult.duplicate400Errors.length > 0) {
          await this.generate400DuplicateTests(validationResult.duplicate400Errors);
        } else if (this.config.duplicateTests.enabled && validationResult.duplicate400Errors.length === 0) {
          console.log(`   ‚ö†Ô∏è  400 —Ç–µ—Å—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã, –Ω–æ –æ—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`);
        }
      } catch (error: any) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error.message);
        if (this.config.debug) {
          console.error('üêõ –ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
        }
        console.log('‚ö†Ô∏è  –ü—Ä–æ–¥–æ–ª–∂–∞—é –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏');
      }
    }

    const grouped = this.config.mergeDuplicateTests
        ? this.groupByStructure(uniqueRequests)
        : this.groupByEndpoint(uniqueRequests);

    console.log(`üìÅ –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–æ –ø–æ ${Object.keys(grouped).length} endpoints\n`);

    let totalTests = 0;
    let newTests = 0;

    for (const [endpoint, requests] of Object.entries(grouped)) {
      const { total, added } = await this.generateTestsForEndpoint(endpoint, requests);
      totalTests += total;
      newTests += added;
    }

    console.log(`\n‚ú® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!`);
    console.log(`   –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${totalTests}`);
    console.log(`   –ù–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤: ${newTests}`);
  }

  /**
   * –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 8: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ - –∑–∞–º–µ–Ω—è–µ–º —á–∏—Å–ª–∞ –Ω–∞ {id}
   */
  private groupByStructure(requests: UniqueRequest[]): Record<string, UniqueRequest[]> {
    const grouped: Record<string, UniqueRequest[]> = {};

    for (const request of requests) {
      // –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ —á–∏—Å–ª–∞ –≤ –ø—É—Ç–∏ –Ω–∞ {id}
      const normalizedEndpoint = request.endpoint.replace(/\/\d+/g, '/{id}');
      const key = `${request.method}:${normalizedEndpoint}`;

      if (!grouped[key]) {
        grouped[key] = [];
      }

      if (grouped[key].length < this.config.maxTestsPerEndpoint) {
        grouped[key].push(request);
      }
    }

    return grouped;
  }

  private groupByEndpoint(requests: UniqueRequest[]): Record<string, UniqueRequest[]> {
    const grouped: Record<string, UniqueRequest[]> = {};

    for (const request of requests) {
      const key = `${request.method}:${request.endpoint}`;

      if (!grouped[key]) {
        grouped[key] = [];
      }

      if (grouped[key].length < this.config.maxTestsPerEndpoint) {
        grouped[key].push(request);
      }
    }

    return grouped;
  }

  private async fetchUniqueRequests(): Promise<UniqueRequest[]> {
    const schema = this.config.dbSchema;
    const conditions: string[] = [];

    if (this.config.onlySuccessful) {
      conditions.push('response_status >= 200 AND response_status < 300');
    }

    if (this.config.endpointFilter.length > 0) {
      const endpoints = this.config.endpointFilter.map(e => `'${e}'`).join(',');
      conditions.push(`endpoint IN (${endpoints})`);
    }

    if (this.config.methodFilter.length > 0) {
      const methods = this.config.methodFilter.map(m => `'${m}'`).join(',');
      conditions.push(`method IN (${methods})`);
    }

    if (!this.config.force) {
      conditions.push('(test_generated IS NULL OR test_generated = FALSE)');
    }

    let requests;

    if (conditions.length > 0) {
      const whereClause = conditions.join(' AND ');

      requests = await this.sql`
        SELECT DISTINCT ON (endpoint, method, request_body::text)
          id,
          endpoint,
          method,
          request_body,
          response_body,
          response_status,
          test_name,
          test_generated,
          test_file_path
        FROM ${this.sql(schema + '.api_requests')}
        WHERE ${this.sql.unsafe(whereClause)}
        ORDER BY endpoint, method, request_body::text, created_at DESC
      `;
    } else {
      requests = await this.sql`
        SELECT DISTINCT ON (endpoint, method, request_body::text)
          id,
          endpoint,
          method,
          request_body,
          response_body,
          response_status,
          test_name,
          test_generated,
          test_file_path
        FROM ${this.sql(schema + '.api_requests')}
        ORDER BY endpoint, method, request_body::text, created_at DESC
      `;
    }

    // –ù–û–í–û–ï v14.0: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ excludeEndpoints –∏ excludeMethods
    let filteredRequests = requests as UniqueRequest[];

    if (this.config.excludeEndpoints.length > 0) {
      const beforeCount = filteredRequests.length;
      filteredRequests = filteredRequests.filter(
        r => !shouldExcludeEndpoint(r.endpoint, this.config.excludeEndpoints)
      );
      if (filteredRequests.length !== beforeCount) {
        console.log(`  üö´ –ò—Å–∫–ª—é—á–µ–Ω–æ –ø–æ excludeEndpoints: ${beforeCount - filteredRequests.length} –∑–∞–ø—Ä–æ—Å–æ–≤`);
      }
    }

    if (this.config.excludeMethods.length > 0) {
      const beforeCount = filteredRequests.length;
      filteredRequests = filteredRequests.filter(
        r => !shouldExcludeMethod(r.method, this.config.excludeMethods)
      );
      if (filteredRequests.length !== beforeCount) {
        console.log(`  üö´ –ò—Å–∫–ª—é—á–µ–Ω–æ –ø–æ excludeMethods: ${beforeCount - filteredRequests.length} –∑–∞–ø—Ä–æ—Å–æ–≤`);
      }
    }

    return filteredRequests;
  }

  private async generateTestsForEndpoint(
      endpointKey: string,
      requests: UniqueRequest[]
  ): Promise<{ total: number; added: number }> {
    const [method, endpoint] = endpointKey.split(':');

    // –ù–û–í–û–ï v12.0: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ (–ò–¥–µ—è 1 + 2)
    if (this.config.deduplication.enabled && requests.length > 1) {
      const beforeCount = requests.length;
      requests = deduplicateTests(requests, this.config.deduplication);
      const afterCount = requests.length;

      if (beforeCount !== afterCount) {
        console.log(`  üîÑ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è ${endpoint}: ${beforeCount} ‚Üí ${afterCount} —Ç–µ—Å—Ç–æ–≤`);
      }
    }

    const fileName = this.endpointToFileName(endpoint, method);

    // –ù–û–í–û–ï v14.0: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    let outputDir = this.config.outputDir;
    if (this.config.groupByCategory) {
      const category = getCategoryFromEndpoint(endpoint);
      outputDir = path.join(this.config.outputDir, category);
    }

    const filePath = path.join(outputDir, `${fileName}.happy-path.test.ts`);
    const fileExists = fs.existsSync(filePath);

    let existingTests: string[] = [];
    let newTestsAdded = 0;

    if (fileExists && !this.config.force) {
      const content = fs.readFileSync(filePath, 'utf-8');
      existingTests = this.extractTestIds(content);

      requests = requests.filter(r => !existingTests.includes(`db-id-${r.id}`));
      newTestsAdded = requests.length;

      if (requests.length === 0) {
        console.log(`  ‚è≠Ô∏è  ${fileName}.happy-path.test.ts - –Ω–µ—Ç –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö`);
        return { total: existingTests.length, added: 0 };
      }

      await this.appendTestsToFile(filePath, endpoint, method, requests);
      console.log(`  ‚úì ${fileName}.happy-path.test.ts (+${requests.length})`);
    } else {
      // –ù–û–í–û–ï v14.0: –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
      if (!fs.existsSync(outputDir)) {
        fs.mkdirSync(outputDir, { recursive: true });
      }

      if (this.config.createSeparateDataFiles) {
        const dataDir = path.join(outputDir, 'test-data');
        if (!fs.existsSync(dataDir)) {
          fs.mkdirSync(dataDir, { recursive: true });
        }
      }

      // v14.8.1: –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
      let savedSettings: Record<string, any> | null = null;
      if (fileExists && this.config.force) {
        const oldContent = fs.readFileSync(filePath, 'utf-8');
        savedSettings = this.extractTestSettings(oldContent);
        if (this.hasNonDefaultSettings(savedSettings)) {
          const nonDefaultCount = Object.values(savedSettings.tests as Record<string, any>)
            .filter(t => t.skipCheckFieldsSingle || t.checkStructureOnlySingle).length;
          console.log(`  üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: global=${savedSettings.global.skipCheckFieldsGlobal || savedSettings.global.checkStructureOnlyGlobal ? '–¥–∞' : '–Ω–µ—Ç'}, —Ç–µ—Å—Ç–æ–≤ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏: ${nonDefaultCount}`);
        }
      }

      const testCode = await this.generateTestFile(endpoint, method, requests, outputDir);
      fs.writeFileSync(filePath, testCode, 'utf-8');

      // v14.8.1: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –Ω–æ–≤–æ–º —Ñ–∞–π–ª–µ
      if (savedSettings && this.hasNonDefaultSettings(savedSettings)) {
        const newContent = fs.readFileSync(filePath, 'utf-8');
        const restoredContent = this.restoreTestSettings(newContent, savedSettings);
        fs.writeFileSync(filePath, restoredContent, 'utf-8');
        console.log(`  ‚ôªÔ∏è  –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ ${fileName}.happy-path.test.ts`);
      }

      newTestsAdded = requests.length;
      const mode = this.config.force ? 'üîÑ' : '‚ú®';
      console.log(`  ${mode} ${fileName}.happy-path.test.ts (${requests.length})`);
    }

    await this.markAsGenerated(requests.map(r => r.id), filePath);

    return {
      total: existingTests.length + newTestsAdded,
      added: newTestsAdded
    };
  }

  private extractTestIds(content: string): string[] {
    const matches = content.matchAll(/\/\/\s*DB ID:\s*(db-id-\d+)/g);
    return Array.from(matches, m => m[1]);
  }

  /**
   * v14.8.1: –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞ —Ç–µ—Å—Ç–∞.
   * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è skipCheckFields* –∏ checkStructureOnly* –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.
   */
  private extractTestSettings(content: string): Record<string, any> {
    const settings: Record<string, any> = {
      global: {
        skipCheckFieldsGlobal: null as string | null,
        checkStructureOnlyGlobal: null as string | null,
      },
      tests: {} as Record<string, { skipCheckFieldsSingle: string | null; checkStructureOnlySingle: string | null }>
    };

    const lines = content.split('\n');
    let currentDbId: string | null = null;

    for (const line of lines) {
      // –§–∞–π–ª–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: skipCheckFieldsGlobal
      const globalSkipMatch = line.match(/^\s*const skipCheckFieldsGlobal: string\[\] = (\[.*\]);/);
      if (globalSkipMatch && globalSkipMatch[1] !== '[]') {
        settings.global.skipCheckFieldsGlobal = globalSkipMatch[1];
      }

      // –§–∞–π–ª–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: checkStructureOnlyGlobal
      const globalStructureMatch = line.match(/^\s*const checkStructureOnlyGlobal = (true|false);/);
      if (globalStructureMatch && globalStructureMatch[1] === 'true') {
        settings.global.checkStructureOnlyGlobal = 'true';
      }

      // –ú–∞—Ä–∫–µ—Ä DB ID ‚Äî –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
      const dbIdMatch = line.match(/\/\/\s*DB ID:\s*db-id-(\d+)/);
      if (dbIdMatch) {
        currentDbId = dbIdMatch[1];
        if (!settings.tests[currentDbId]) {
          settings.tests[currentDbId] = { skipCheckFieldsSingle: null, checkStructureOnlySingle: null };
        }
      }

      if (currentDbId) {
        // –£—Ä–æ–≤–µ–Ω—å —Ç–µ—Å—Ç–∞: skipCheckFieldsSingle
        const singleSkipMatch = line.match(/^\s*const skipCheckFieldsSingle: string\[\] = (\[.*\]);/);
        if (singleSkipMatch && singleSkipMatch[1] !== '[]') {
          settings.tests[currentDbId].skipCheckFieldsSingle = singleSkipMatch[1];
        }

        // –£—Ä–æ–≤–µ–Ω—å —Ç–µ—Å—Ç–∞: checkStructureOnlySingle
        const singleStructureMatch = line.match(/^\s*const checkStructureOnlySingle = (true|false);/);
        if (singleStructureMatch) {
          if (singleStructureMatch[1] === 'true') {
            settings.tests[currentDbId].checkStructureOnlySingle = 'true';
          }
          currentDbId = null; // –æ–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Å—á–∏—Ç–∞–Ω—ã ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ–º
        }
      }
    }

    return settings;
  }

  /**
   * v14.8.1: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –Ω–æ–≤–æ–º —Ñ–∞–π–ª–µ —Ç–µ—Å—Ç–∞.
   * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è skipCheckFields* –∏ checkStructureOnly* –ø–æ DB ID.
   */
  private restoreTestSettings(content: string, settings: Record<string, any>): string {
    let result = content;

    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∞–π–ª–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
    if (settings.global.skipCheckFieldsGlobal) {
      result = result.replace(
        /^(const skipCheckFieldsGlobal: string\[\] = )\[\];/m,
        `$1${settings.global.skipCheckFieldsGlobal};`
      );
    }
    if (settings.global.checkStructureOnlyGlobal === 'true') {
      result = result.replace(
        /^(const checkStructureOnlyGlobal = )false;/m,
        `$1true;`
      );
    }

    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ –ø–æ DB ID
    for (const [dbId, testSettings] of Object.entries(settings.tests as Record<string, any>)) {
      if (!testSettings.skipCheckFieldsSingle && !testSettings.checkStructureOnlySingle) continue;

      // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é DB ID –≤ —Ñ–∞–π–ª–µ –∏ –∑–∞–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–û–°–õ–ï –Ω–µ–≥–æ
      const dbIdMarker = `// DB ID: db-id-${dbId}`;
      const markerPos = result.indexOf(dbIdMarker);
      if (markerPos === -1) continue; // —ç—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞ –Ω–µ—Ç –≤ –Ω–æ–≤–æ–º —Ñ–∞–π–ª–µ ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º

      // –ë–µ—Ä—ë–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç –ø–æ—Å–ª–µ –º–∞—Ä–∫–µ—Ä–∞ (–¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ DB ID –∏–ª–∏ –∫–æ–Ω—Ü–∞)
      const nextMarkerPos = result.indexOf('// DB ID: db-id-', markerPos + dbIdMarker.length);
      const blockEnd = nextMarkerPos !== -1 ? nextMarkerPos : result.length;
      const block = result.slice(markerPos, blockEnd);

      let newBlock = block;

      if (testSettings.skipCheckFieldsSingle) {
        newBlock = newBlock.replace(
          /^(\s*const skipCheckFieldsSingle: string\[\] = )\[\];/m,
          `$1${testSettings.skipCheckFieldsSingle};`
        );
      }
      if (testSettings.checkStructureOnlySingle === 'true') {
        newBlock = newBlock.replace(
          /^(\s*const checkStructureOnlySingle = )false;/m,
          `$1true;`
        );
      }

      result = result.slice(0, markerPos) + newBlock + result.slice(blockEnd);
    }

    return result;
  }

  /** v14.8.1: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ –≤ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ö–æ—Ç—å —á—Ç–æ-—Ç–æ –Ω–µ-–¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ */
  private hasNonDefaultSettings(settings: Record<string, any>): boolean {
    if (settings.global.skipCheckFieldsGlobal || settings.global.checkStructureOnlyGlobal) return true;
    return Object.values(settings.tests as Record<string, any>)
      .some(t => t.skipCheckFieldsSingle || t.checkStructureOnlySingle);
  }

  private async appendTestsToFile(
      filePath: string,
      endpoint: string,
      method: string,
      requests: UniqueRequest[]
  ): Promise<void> {
    let content = fs.readFileSync(filePath, 'utf-8');
    const lastBraceIndex = content.lastIndexOf('});');

    if (lastBraceIndex === -1) {
      throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–æ–Ω–µ—Ü describe –±–ª–æ–∫–∞ –≤ ${filePath}`);
    }

    // –ù–∞—Ö–æ–¥–∏–º DTO
    let dtoInfo: DTOInfo | null = null;
    if (this.config.apiGeneratedPath) {
      dtoInfo = findDtoForEndpoint(this.config.apiGeneratedPath, endpoint, method);
    }

    const newTests = await Promise.all(
        requests.map((req, index) => this.generateSingleTest(endpoint, method, req, index + 1, dtoInfo))
    );

    content = content.slice(0, lastBraceIndex) + '\n' + newTests.join('\n\n') + '\n' + content.slice(lastBraceIndex);
    fs.writeFileSync(filePath, content, 'utf-8');
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞
   * @param endpoint - –≠–Ω–¥–ø–æ–∏–Ω—Ç API
   * @param method - HTTP –º–µ—Ç–æ–¥
   * @param requests - –ú–∞—Å—Å–∏–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
   * @param outputDir - –ü–∞–ø–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (—Å —É—á—ë—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å–ª–∏ groupByCategory: true)
   */
  private async generateTestFile(endpoint: string, method: string, requests: UniqueRequest[], outputDir: string): Promise<string> {
    // –ò—â–µ–º DTO
    let dtoInfo: DTOInfo | null = null;

    if (this.config.apiGeneratedPath) {
      dtoInfo = findDtoForEndpoint(this.config.apiGeneratedPath, endpoint, method);
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º–ø–æ—Ä—Ç—ã
    const imports: string[] = [
      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç
      `import test, { expect } from '${this.config.testImportPath}';`,
      `import axios from 'axios';`,
    ];

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 11: –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏–∑ NPM –ø–∞–∫–µ—Ç–∞
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.1: formatDifferencesAsBlocks –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ test-helpers –µ—Å–ª–∏ createSeparateDataFiles=true
    if (this.config.createSeparateDataFiles) {
      // –¢–æ–ª—å–∫–æ compareDbWithResponse - formatDifferencesAsBlocks –ø—Ä–∏–¥—ë—Ç –∏–∑ test-helpers
      imports.push(`import { compareDbWithResponse } from '${this.config.packageName}/dist/utils/data-comparison';`);
    } else {
      // –û–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø–∞–∫–µ—Ç–∞
      imports.push(`import { compareDbWithResponse, formatDifferencesAsBlocks } from '${this.config.packageName}/dist/utils/data-comparison';`);
    }

    // –ò–º–ø–æ—Ä—Ç axios –∫–æ–Ω—Ñ–∏–≥–∞
    if (this.config.axiosConfigPath && this.config.axiosConfigName) {
      imports.push(`import { ${this.config.axiosConfigName} } from '${this.config.axiosConfigPath}';`);
    }

    // –ù–û–í–û–ï v14.1: –ò–º–ø–æ—Ä—Ç handleApiError –∏–∑ apiTestHelper (—Å–æ–¥–µ—Ä–∂–∏—Ç email –ª–æ–≥–∏–∫—É –≤–Ω—É—Ç—Ä–∏)
    if (this.config.apiTestHelperPath) {
      imports.push(`import { handleApiError } from '${this.config.apiTestHelperPath}';`);
    }

    // –ù–û–í–û–ï v14.1: –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ email –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
    if (this.config.send5xxEmailNotification && this.config.emailHelperPath) {
      imports.push(`import { ${this.config.emailHelperMethodName} } from '${this.config.emailHelperPath}';`);
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 10: –ò–º–ø–æ—Ä—Ç DTO
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.1: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π outputDir –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏
    if (dtoInfo) {
      const dtoImportPath = this.getRelativePath(outputDir, dtoInfo.filePath);
      imports.push(`import type { ${dtoInfo.name} } from '${dtoImportPath}';`);
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 9: –ò–º–ø–æ—Ä—Ç—ã –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    if (this.config.createSeparateDataFiles) {
      const fileName = this.endpointToFileName(endpoint, method);
      // –ù–û–í–û–ï v14.5: –ò–º–ø–æ—Ä—Ç helper —Ñ—É–Ω–∫—Ü–∏–π (–≤–∫–ª—é—á–∞—è formatDifferencesAsBlocks)
      // –ù–û–í–û–ï v14.5.8: –î–æ–±–∞–≤–ª–µ–Ω getAxiosConfigWithoutContentLength
      imports.push(`import { prepareUniqueFields, buildCurlCommand, compareWithoutUniqueFields, verifyUniqueFields, formatDifferencesAsBlocks, getAxiosConfigWithoutContentLength } from './test-data/test-helpers';`);
      for (let i = 0; i < requests.length; i++) {
        imports.push(`import { requestData as requestData${i + 1}, normalizedExpectedResponse as normalizedExpectedResponse${i + 1} } from './test-data/${fileName}-data-${i + 1}';`);
      }
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç—ã
    const tests = await Promise.all(
        requests.map((req, index) => this.generateSingleTest(endpoint, method, req, index + 1, dtoInfo))
    );

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 9: –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª—ã —Å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.1: –ü–µ—Ä–µ–¥–∞—ë–º outputDir —Å —É—á—ë—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    if (this.config.createSeparateDataFiles) {
      await this.createDataFiles(endpoint, method, requests, dtoInfo, outputDir);
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –†–∞–Ω–¥–æ–º–Ω—ã–π –Ω–æ–º–µ—Ä
    const randomId = Math.floor(Math.random() * 10000);

    return `${imports.join('\n')}

const endpoint = '${endpoint}';
const httpMethod = '${method}';

// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 2: –¢–æ–ª—å–∫–æ 200-—ã–µ –∫–æ–¥—ã
const apiErrorCodes = {
  success: 200,
  created: 201,
  noContent: 204,
};

const success = apiErrorCodes.${this.getSuccessCodeName(requests[0]?.response_status || 200)};

// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
const caseInfoObj = {
  testCase: 'HP-${randomId}',
  aqaOwner: 'HappyPathGenerator',
  tms_testName: 'Happy path —Ç–µ—Å—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π ${method} ${endpoint}',
  testType: 'api'
};

// –ù–û–í–û–ï v14.6: –ü–æ–ª—è –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ù–ê–õ–ò–ß–ò–ï, –Ω–æ –Ω–µ –ó–ù–ê–ß–ï–ù–ò–ï (–¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ)
// –ü—Ä–∏–º–µ—Ä: ['totalAmount', 'pagination.total', 'meta.count']
const skipCheckFieldsGlobal: string[] = [];

// –ù–û–í–û–ï v14.8: –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ –°–¢–†–£–ö–¢–£–†–£ –æ—Ç–≤–µ—Ç–∞ (–ø–æ–ª—è –∏ —Ç–∏–ø—ã), –Ω–æ –Ω–µ –∑–Ω–∞—á–µ–Ω–∏—è (–¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ)
// –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Å–æ —Å–ø–∏—Å–∫–∞–º–∏/–ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏
const checkStructureOnlyGlobal = false;

test.describe.configure({ mode: "parallel" });
test.describe(\`API —Ç–µ—Å—Ç—ã –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ \${httpMethod} >> \${endpoint} - Happy Path\`, async () => {

  // ============================================
  // HAPPY PATH –¢–ï–°–¢–´
  // ============================================

${tests.join('\n\n')}

});
`;
  }

  /**
   * –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 9: –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª—ã —Å –ù–û–†–ú–ê–õ–ò–ó–û–í–ê–ù–ù–´–ú–ò –¥–∞–Ω–Ω—ã–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ DTO
   * –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.1: –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä outputDir –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å groupByCategory
   */
  private async createDataFiles(
      endpoint: string,
      method: string,
      requests: UniqueRequest[],
      dtoInfo: DTOInfo | null,
      outputDir: string
  ): Promise<void> {
    const fileName = this.endpointToFileName(endpoint, method);
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.1: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π outputDir –≤–º–µ—Å—Ç–æ this.config.outputDir
    const dataDir = path.join(outputDir, 'test-data');

    if (!fs.existsSync(dataDir)) {
      fs.mkdirSync(dataDir, { recursive: true });
    }

    // –ù–û–í–û–ï v14.5: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∞–π–ª —Å helper —Ñ—É–Ω–∫—Ü–∏—è–º–∏ (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –ø–∞–ø–∫—É)
    // –ù–û–í–û–ï v14.5.4: –î–æ–±–∞–≤–ª–µ–Ω—ã skipCompareFields –∏ ignoreFieldValues
    const helpersFilePath = path.join(dataDir, 'test-helpers.ts');
    if (!fs.existsSync(helpersFilePath)) {
      const helpersConfig: TestHelpersConfig = {
        uniqueFields: this.config.uniqueFields,
        uniqueFieldsUpperCase: this.config.uniqueFieldsUpperCase,
        packageName: this.config.packageName,
        skipCompareFields: this.config.skipCompareFields,
        ignoreFieldValues: this.config.ignoreFieldValues
      };
      const helpersCode = generateTestHelpersCode(helpersConfig);
      fs.writeFileSync(helpersFilePath, helpersCode, 'utf-8');
    }

    for (let i = 0; i < requests.length; i++) {
      const request = requests[i];
      const dataFileName = `${fileName}-data-${i + 1}.ts`;
      const dataFilePath = path.join(dataDir, dataFileName);

      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 7: –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ DTO
      let normalizedResponse;

      if (dtoInfo) {
        normalizedResponse = normalizeDbDataByDto(request.response_body, dtoInfo);
      } else {
        normalizedResponse = normalizeDbData(request.response_body);
      }

      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.2: –ï—Å–ª–∏ request_body —Å—Ç—Ä–æ–∫–∞ - –ø–∞—Ä—Å–∏–º –ø–µ—Ä–µ–¥ stringify
      let requestBodyForExport = request.request_body;
      if (typeof requestBodyForExport === 'string') {
        try {
          requestBodyForExport = JSON.parse(requestBodyForExport);
        } catch {
          // –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
        }
      }

      const dataContent = `/**
 * –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è ${method} ${endpoint}
 * DB ID: ${request.id}
 */

export const requestData = ${JSON.stringify(requestBodyForExport, null, 2)};

// –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π response (–≥–æ—Ç–æ–≤—ã–π –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
export const normalizedExpectedResponse = ${JSON.stringify(normalizedResponse, null, 2)};
`;

      fs.writeFileSync(dataFilePath, dataContent, 'utf-8');
    }
  }

  /**
   * –ü–û–õ–ù–û–°–¢–¨–Æ –ü–ï–†–ï–ü–ò–°–ê–ù–ù–´–ô –º–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∞
   * –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø 4, 5, 6, 7
   */
  private async generateSingleTest(
      endpoint: string,
      method: string,
      request: UniqueRequest,
      testNumber: number,
      dtoInfo: DTOInfo | null
  ): Promise<string> {
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ä–∞–Ω–¥–æ–º–Ω—ã–π –Ω–æ–º–µ—Ä
    const randomId = Math.floor(Math.random() * 1000);
    const testName = `Happy path #${testNumber} (ID: ${randomId})`;
    const hasBody = ['POST', 'PUT', 'PATCH'].includes(method);

    const standUrlVar = `process.env.${this.config.standUrlEnvVar}`;
    const axiosConfig = this.config.axiosConfigName;

    let testCode = `  test(\`\${httpMethod} ${testName} (\${success}) @api ${this.config.testTag}\`, async ({ page }, testInfo) => {
    // DB ID: db-id-${request.id}
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 12: –†–µ–∞–ª—å–Ω—ã–π endpoint —Å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø—É—Ç–∏
    const actualEndpoint = '${request.endpoint}';
    // –ù–û–í–û–ï v14.6: –ü–æ–ª—è –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ù–ê–õ–ò–ß–ò–ï, –Ω–æ –Ω–µ –ó–ù–ê–ß–ï–ù–ò–ï (—Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞)
    // –ü—Ä–∏–º–µ—Ä: ['totalAmount', 'pagination.total']
    const skipCheckFieldsSingle: string[] = [];
    const skipCheckFields = [...skipCheckFieldsGlobal, ...skipCheckFieldsSingle];
    // –ù–û–í–û–ï v14.8: –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ –°–¢–†–£–ö–¢–£–†–£ –æ—Ç–≤–µ—Ç–∞ (–ø–æ–ª—è –∏ —Ç–∏–ø—ã), –Ω–æ –Ω–µ –∑–Ω–∞—á–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞)
    const checkStructureOnlySingle = false;
    const checkStructureOnly = checkStructureOnlyGlobal || checkStructureOnlySingle;
`;

    // –î–∞–Ω–Ω—ã–µ
    if (this.config.createSeparateDataFiles) {
      if (hasBody) {
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.7: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–ø–∏—è –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤ –∏ –æ–±—ä–µ–∫—Ç–æ–≤
        testCode += `    let requestData = Array.isArray(requestData${testNumber}) ? [...requestData${testNumber}] : { ...requestData${testNumber} };
`;
      }
      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 9: –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –Ω–µ –æ–±—ä–µ–∫—Ç —Ü–µ–ª–∏–∫–æ–º
      testCode += `    const normalizedExpected = normalizedExpectedResponse${testNumber};

`;
    } else {
      if (hasBody) {
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.2: –ï—Å–ª–∏ request_body —Å—Ç—Ä–æ–∫–∞ - –ø–∞—Ä—Å–∏–º –ø–µ—Ä–µ–¥ stringify
        let requestBodyObj = request.request_body;
        if (typeof requestBodyObj === 'string') {
          try {
            requestBodyObj = JSON.parse(requestBodyObj);
          } catch {
            // –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
          }
        }
        testCode += `    const requestData = ${JSON.stringify(requestBodyObj, null, 4).replace(/^/gm, '    ')};

`;
      }

      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 7: –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ DTO
      let normalizedResponse;
      if (dtoInfo) {
        normalizedResponse = normalizeDbDataByDto(request.response_body, dtoInfo);
      } else {
        normalizedResponse = normalizeDbData(request.response_body);
      }

      testCode += `    const normalizedExpected = ${JSON.stringify(normalizedResponse, null, 4).replace(/^/gm, '    ')};
    
`;
    }

    // –ù–û–í–û–ï v14.2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø–æ–ª–µ–π (–∏–∑–±–µ–≥–∞–µ–º 400 "–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
    // –ù–û–í–û–ï v14.5: –ò—Å–ø–æ–ª—å–∑—É–µ–º helper —Ñ—É–Ω–∫—Ü–∏—é –≤–º–µ—Å—Ç–æ inline –∫–æ–¥–∞
    const useUniqueFields = hasBody && this.config.enableUniqueFieldGeneration && this.config.uniqueFields.length > 0;
    const useSeparateDataFiles = this.config.createSeparateDataFiles;

    if (useUniqueFields) {
      if (useSeparateDataFiles) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º helper —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ test-helpers.ts
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5: prepareUniqueFields –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º
        testCode += `    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è 400 "–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    const { data: preparedData, modifiedFields: modifiedUniqueFields } = prepareUniqueFields(requestData);
    requestData = preparedData;

`;
      } else {
        // Inline –∫–æ–¥ –∫–æ–≥–¥–∞ –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö
        const uniqueFieldsList = this.config.uniqueFields;
        const upperCaseFields = this.config.uniqueFieldsUpperCase;
        testCode += `    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫ 400 "–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    const uniqueSuffix = \`_\${Date.now()}_\${Math.random().toString(36).substring(2, 7)}\`;
    const modifiedUniqueFields: Record<string, string> = {};
`;
        for (const field of uniqueFieldsList) {
          const isUpperCase = upperCaseFields.includes(field);
          if (isUpperCase) {
            testCode += `    if (requestData.${field} && typeof requestData.${field} === 'string') {
      requestData.${field} = (requestData.${field} + uniqueSuffix).toUpperCase();
      modifiedUniqueFields['${field}'] = requestData.${field};
    }
`;
          } else {
            testCode += `    if (requestData.${field} && typeof requestData.${field} === 'string') {
      requestData.${field} = requestData.${field} + uniqueSuffix;
      modifiedUniqueFields['${field}'] = requestData.${field};
    }
`;
          }
        }
        testCode += `
`;
      }
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 4: –ó–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ catch —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
    testCode += `    let response;

    try {
`;

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.8: –ò—Å–ø–æ–ª—å–∑—É–µ–º getAxiosConfigWithoutContentLength –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è Content-Length
    if (hasBody) {
      testCode += `      response = await axios.${method.toLowerCase()}(${standUrlVar} + actualEndpoint, requestData, getAxiosConfigWithoutContentLength(${axiosConfig}));
`;
    } else {
      testCode += `      response = await axios.${method.toLowerCase()}(${standUrlVar} + actualEndpoint, getAxiosConfigWithoutContentLength(${axiosConfig}));
`;
    }

    // –ù–û–í–û–ï v14.1: –ò—Å–ø–æ–ª—å–∑—É–µ–º handleApiError –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ (email –ª–æ–≥–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏)
    const useApiTestHelper = this.config.apiTestHelperPath ? true : false;
    const use5xxEmailNotification = this.config.send5xxEmailNotification && this.config.emailHelperPath;
    const emailMethodName = this.config.emailHelperMethodName || 'sendErrorMailbyApi';

    if (useApiTestHelper) {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π handleApiError
      testCode += `    } catch (error: any) {
      await handleApiError({
        error,
        testInfo,
        endpoint: actualEndpoint,
        method: httpMethod,
        standUrl: ${standUrlVar},${hasBody ? `
        requestBody: requestData,` : ''}
        axiosConfig: ${axiosConfig},${use5xxEmailNotification ? `
        sendEmailFn: ${emailMethodName}` : ''}
      });
    }
`;
    } else {
      // Fallback –±–µ–∑ apiTestHelper
      testCode += `    } catch (error: any) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ endpoint:');
      console.error('Endpoint:', actualEndpoint);
      console.error('Method:', httpMethod);
      console.error('Response status:', error.response?.status);
      console.error('Response data:', JSON.stringify(error.response?.data, null, 2));
      console.error('Error message:', error.message);
      throw error;
    }
`;
    }

    testCode += `
    // –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    await expect(response.status).toBe(success);
    await expect(response.data).toBeDefined();
`;

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 6: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ DTO
    if (dtoInfo && dtoInfo.fields.length > 0) {
      testCode += `\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏–∑ DTO: ${dtoInfo.name}\n`;

      for (const field of dtoInfo.fields.slice(0, 5)) {
        const jsType = this.getJsType(field.type);

        if (jsType === 'array') {
          testCode += `    await expect(Array.isArray(response.data.${field.name})).toBe(true);\n`;
        } else if (jsType) {
          testCode += `    await expect(typeof response.data.${field.name}).toBe('${jsType}');\n`;
        }
      }
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –∏–∑ DTO
    if (dtoInfo && dtoInfo.fields.length > 0) {
      testCode += `\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –∏–∑ DTO: ${dtoInfo.name}\n`;

      const requiredFields = dtoInfo.fields.filter(f => f.required);
      for (const field of requiredFields.slice(0, 5)) {
        testCode += `    await expect(response.data.${field.name}).toBeDefined();\n`;
      }
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 5: –ò—Å–ø–æ–ª—å–∑—É–µ–º deepCompareObjects –≤–º–µ—Å—Ç–æ toMatchObject
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 13: –£–ª—É—á—à–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–∞–∑–ª–∏—á–∏–π —Å —Ü–≤–µ—Ç–∞–º–∏ (–±–ª–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)
    // –ù–û–í–û–ï v14.1: –ü—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –≤—ã–≤–æ–¥–∏–º endpoint, –º–µ—Ç–æ–¥ –∏ CURL –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
    // –ù–û–í–û–ï v14.1: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –µ—Å–ª–∏ –æ–∂–∏–¥–∞–µ–º—ã–π response –ø—É—Å—Ç–æ–π (null, undefined, "")
    // –ù–û–í–û–ï v14.2: –û—Ç–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π + –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏—Ö –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    testCode += `
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π –æ–∂–∏–¥–∞–µ–º—ã–π response - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    const isEmptyExpected = normalizedExpected === null ||
                            normalizedExpected === undefined ||
                            normalizedExpected === '' ||
                            (typeof normalizedExpected === 'object' && Object.keys(normalizedExpected).length === 0);

    if (isEmptyExpected) {
      // –î–ª—è –ø—É—Å—Ç—ã—Ö response –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω
      console.log('‚ÑπÔ∏è –û–∂–∏–¥–∞–µ–º—ã–π response –ø—É—Å—Ç–æ–π - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å –∫–æ–¥');
    } else {
`;

    // –ù–û–í–û–ï v14.2: –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –¥–ª—è POST/PUT/PATCH
    // –ù–û–í–û–ï v14.5: –ò—Å–ø–æ–ª—å–∑—É–µ–º helper —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–≥–¥–∞ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö
    if (useUniqueFields) {
      if (useSeparateDataFiles) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º helper —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ test-helpers.ts
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.4: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ response
        testCode += `      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (response –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–æ —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏)
      // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –ï–°–¢–¨ –≤ response (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ endpoint –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–æ–ª—å–∫–æ id)
      const { allMatch, mismatches, skippedFields } = verifyUniqueFields(response.data, modifiedUniqueFields);
      if (skippedFields.length > 0) {
        console.log('‚ÑπÔ∏è –ü—Ä–æ–ø—É—â–µ–Ω—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ response):', skippedFields);
      }
      if (!allMatch) {
        console.error('‚ùå –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π:', mismatches);
      }
      await expect(allMatch, '–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å').toBe(true);

      // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (–±–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö)
      const comparison = compareWithoutUniqueFields(normalizedExpected, response.data, modifiedUniqueFields, skipCheckFields, checkStructureOnly);
`;
      } else {
        // Inline –∫–æ–¥ –∫–æ–≥–¥–∞ –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–∞–Ω–Ω—ã—Ö
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.4: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ response
        testCode += `      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (response –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–æ —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏)
      // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –ï–°–¢–¨ –≤ response (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ endpoint –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–æ–ª—å–∫–æ id)
      const uniqueFieldErrors: string[] = [];
      const skippedUniqueFields: string[] = [];
      for (const [fieldName, sentValue] of Object.entries(modifiedUniqueFields)) {
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.4: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª–µ –°–£–©–ï–°–¢–í–£–ï–¢ –≤ response
        if (response.data && fieldName in response.data) {
          const receivedValue = response.data[fieldName];
          if (receivedValue !== sentValue) {
            uniqueFieldErrors.push(\`–ü–æ–ª–µ '\${fieldName}': –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ '\${sentValue}', –ø–æ–ª—É—á–µ–Ω–æ '\${receivedValue}'\`);
          }
        } else {
          // –ü–æ–ª–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ response - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º (–Ω–µ —Å—á–∏—Ç–∞–µ–º –æ—à–∏–±–∫–æ–π)
          skippedUniqueFields.push(fieldName);
        }
      }
      if (skippedUniqueFields.length > 0) {
        console.log('‚ÑπÔ∏è –ü—Ä–æ–ø—É—â–µ–Ω—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ response):', skippedUniqueFields);
      }
      if (uniqueFieldErrors.length > 0) {
        console.error('‚ùå –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π:', uniqueFieldErrors);
      }
      await expect(uniqueFieldErrors.length, '–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å').toBe(0);

      // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (–±–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö)
      const uniqueFieldNames = Object.keys(modifiedUniqueFields);
      const removeFields = (obj: any, fields: string[]): any => {
        if (!obj || typeof obj !== 'object') return obj;
        const result = { ...obj };
        fields.forEach(f => delete result[f]);
        return result;
      };
      const comparison = compareDbWithResponse(removeFields(normalizedExpected, uniqueFieldNames), removeFields(response.data, uniqueFieldNames), skipCheckFields, checkStructureOnly);
`;
      }
    } else {
      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5: –ö–æ–≥–¥–∞ –Ω–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π - –æ–±—ã—á–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
      if (useSeparateDataFiles) {
        testCode += `      // –ì–ª—É–±–æ–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π
      const comparison = compareWithoutUniqueFields(normalizedExpected, response.data, {}, skipCheckFields, checkStructureOnly);
`;
      } else {
        testCode += `      // –ì–ª—É–±–æ–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π
      const comparison = compareDbWithResponse(normalizedExpected, response.data, skipCheckFields, checkStructureOnly);
`;
      }
    }

    // –ù–û–í–û–ï v14.5: –ò—Å–ø–æ–ª—å–∑—É–µ–º helper –¥–ª—è CURL –µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö
    if (useSeparateDataFiles) {
      testCode += `
      if (!comparison.isEqual) {
        console.log(formatDifferencesAsBlocks(comparison.differences));
        console.log('\\nüìç Endpoint:', actualEndpoint, '| Method:', httpMethod);
        console.log('üìã CURL:', buildCurlCommand(httpMethod, ${standUrlVar} + actualEndpoint, ${hasBody ? 'requestData' : 'undefined'}, ${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization));
      }

      await expect(comparison.isEqual).toBe(true);
    }
  });`;
    } else {
      // Inline CURL –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–≥–¥–∞ –Ω–µ—Ç helper —Ñ—É–Ω–∫—Ü–∏–π
      testCode += `
      if (!comparison.isEqual) {
        console.log(formatDifferencesAsBlocks(comparison.differences));
        console.log('\\nüìç Endpoint:', actualEndpoint, '| Method:', httpMethod);
`;
      if (hasBody) {
        testCode += `        const curlCmd = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' -H 'Content-Type: application/json' -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}' -d '\${JSON.stringify(requestData)}'\`;
        console.log('üìã CURL:', curlCmd);
`;
      } else {
        testCode += `        const curlCmd = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}'\`;
        console.log('üìã CURL:', curlCmd);
`;
      }
      testCode += `      }

      await expect(comparison.isEqual).toBe(true);
    }
  });`;
    }

    return testCode;
  }

  private getJsType(tsType: string): string | null {
    tsType = tsType.toLowerCase().trim();

    if (tsType.includes('string')) return 'string';
    if (tsType.includes('number')) return 'number';
    if (tsType.includes('boolean')) return 'boolean';
    if (tsType.includes('[]') || tsType.includes('array')) return 'array';
    if (tsType === 'object') return 'object';

    return null;
  }

  private getRelativePath(from: string, to: string): string {
    const relative = path.relative(path.dirname(from), to);
    return relative.startsWith('.') ? relative.replace(/\.ts$/, '') : `./${relative.replace(/\.ts$/, '')}`;
  }

  private endpointToFileName(endpoint: string, method: string): string {
    let fileName = endpoint
        .replace(/^\/api\/v[0-9]+\//, '')
        .replace(/\{[^}]+\}/g, 'id')
        .replace(/\/\d+/g, '-id') // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 8: –ß–∏—Å–ª–∞ ‚Üí -id
        .replace(/\//g, '-')
        .replace(/[^a-z0-9-]/gi, '')
        .toLowerCase();

    fileName = `${method.toLowerCase()}-${fileName}`;

    return fileName;
  }

  private getSuccessCodeName(status: number): string {
    if (status === 201) return 'created';
    if (status === 204) return 'noContent';
    return 'success';
  }

  private async markAsGenerated(ids: number[], filePath: string): Promise<void> {
    const schema = this.config.dbSchema;

    for (const id of ids) {
      await this.sql`
        UPDATE ${this.sql(schema + '.api_requests')}
        SET
          test_generated = TRUE,
          test_file_path = ${filePath},
          generated_at = NOW()
        WHERE id = ${id}
      `;
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ù–û–í–û–ï v14.3: –ì–ï–ù–ï–†–ê–¶–ò–Ø –¢–ï–°–¢–û–í –ù–ê –í–ê–õ–ò–î–ê–¶–ò–Æ (422 –û–®–ò–ë–ö–ò)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã –¥–ª—è 422 –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   * –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç: —Å—Ç–∞—Ç—É—Å 422 + –æ–∂–∏–¥–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
   */
  async generateValidation422Tests(validation422Errors: Validation422Error[]): Promise<void> {
    if (!this.config.validationTests.enabled || validation422Errors.length === 0) {
      return;
    }

    console.log(`\nüìã –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é (422)...`);
    console.log(`   –ù–∞–π–¥–µ–Ω–æ ${validation422Errors.length} –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π`);

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    const validationOutputDir = path.resolve(
      this.config.outputDir,
      this.config.validationTests.outputDir || '../validation-tests'
    );

    if (!fs.existsSync(validationOutputDir)) {
      fs.mkdirSync(validationOutputDir, { recursive: true });
    }

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ endpoint + method
    const grouped = this.groupValidation422Errors(validation422Errors);

    let totalTests = 0;
    let newTests = 0;

    for (const [key, errors] of Object.entries(grouped)) {
      const { total, added } = await this.generateValidation422TestsForEndpoint(key, errors, validationOutputDir);
      totalTests += total;
      newTests += added;
    }

    console.log(`\n‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!`);
    console.log(`   –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${totalTests}`);
    console.log(`   –ù–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤: ${newTests}`);
  }

  /**
   * –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç 422 –æ—à–∏–±–∫–∏ –ø–æ endpoint + method
   */
  private groupValidation422Errors(errors: Validation422Error[]): Record<string, Validation422Error[]> {
    const grouped: Record<string, Validation422Error[]> = {};
    const maxTests = this.config.validationTests.maxTestsPerEndpoint || 3;

    for (const error of errors) {
      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º endpoint (–∑–∞–º–µ–Ω—è–µ–º —á–∏—Å–ª–∞ –Ω–∞ {id})
      const normalizedEndpoint = error.endpoint.replace(/\/\d+/g, '/{id}');
      const key = `${error.method}:${normalizedEndpoint}`;

      if (!grouped[key]) {
        grouped[key] = [];
      }

      if (grouped[key].length < maxTests) {
        grouped[key].push(error);
      }
    }

    return grouped;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ endpoint
   */
  private async generateValidation422TestsForEndpoint(
    key: string,
    errors: Validation422Error[],
    outputDir: string
  ): Promise<{ total: number; added: number }> {
    const [method, endpoint] = key.split(':');

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ –ø–∞–ø–∫–∞–º)
    let category = '';
    if (this.config.validationTests.groupByCategory) {
      const parts = endpoint.split('/').filter(Boolean);
      // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –∑–Ω–∞—á–∏–º—ã–π —Å–µ–≥–º–µ–Ω—Ç –ø–æ—Å–ª–µ api/v1/
      const startIndex = parts.findIndex(p => p.match(/^v\d+$/));
      if (startIndex >= 0 && parts[startIndex + 1]) {
        category = parts[startIndex + 1];
      } else if (parts.length > 0) {
        category = parts[0];
      }
    }

    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
    const fileName = this.endpointToFileName(endpoint, method) + '-validation';
    const categoryDir = category ? path.join(outputDir, category) : outputDir;

    if (!fs.existsSync(categoryDir)) {
      fs.mkdirSync(categoryDir, { recursive: true });
    }

    const testFilePath = path.join(categoryDir, `${fileName}.test.ts`);
    const testDataDir = path.join(categoryDir, 'test-data');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ñ–∞–π–ª
    if (fs.existsSync(testFilePath) && !this.config.force) {
      console.log(`  ‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç): ${fileName}`);
      return { total: errors.length, added: 0 };
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
    const testCode = await this.generateValidation422TestFile(endpoint, method, errors, testDataDir, testFilePath);

    fs.writeFileSync(testFilePath, testCode, 'utf-8');
    console.log(`  ‚úì –°–æ–∑–¥–∞–Ω: ${fileName} (${errors.length} —Ç–µ—Å—Ç–æ–≤)`);

    return { total: errors.length, added: errors.length };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ —Ñ–∞–π–ª–∞ —Å —Ç–µ—Å—Ç–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   */
  private async generateValidation422TestFile(
    endpoint: string,
    method: string,
    errors: Validation422Error[],
    testDataDir: string,
    testFilePath: string
  ): Promise<string> {
    const standUrlVar = `process.env.${this.config.standUrlEnvVar}`;
    const axiosConfig = this.config.axiosConfigName;
    const testTag = this.config.validationTests.testTag || '@apiValidation';
    const createDataFiles = this.config.validationTests.createSeparateDataFiles;

    // –ò–º–ø–æ—Ä—Ç—ã
    let code = `/**
 * –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ API (422 –æ—à–∏–±–∫–∏)
 * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${new Date().toISOString()}
 * Endpoint: ${method} ${endpoint}
 *
 * –≠—Ç–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
 * - –°—Ç–∞—Ç—É—Å 422 Unprocessable Entity
 * - –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
 */

import { test, expect } from '${this.config.testImportPath}';
import axios from 'axios';
import { ${axiosConfig} } from '${this.config.axiosConfigPath}';
`;

    // –ò–º–ø–æ—Ä—Ç apiTestHelper –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
    if (this.config.apiTestHelperPath) {
      code += `import { handleApiError, getMessageFromError } from '${this.config.apiTestHelperPath}';\n`;
    }

    // –ò–º–ø–æ—Ä—Ç email helper –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
    if (this.config.send5xxEmailNotification && this.config.emailHelperPath) {
      code += `import { ${this.config.emailHelperMethodName || 'sendErrorMailbyApi'} } from '${this.config.emailHelperPath}';\n`;
    }

    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    if (createDataFiles) {
      // –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É test-data
      if (!fs.existsSync(testDataDir)) {
        fs.mkdirSync(testDataDir, { recursive: true });
      }

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∞–π–ª —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
      const dataFileName = this.endpointToFileName(endpoint, method) + '-validation-data';
      const dataFilePath = path.join(testDataDir, `${dataFileName}.ts`);

      let dataCode = `/**
 * –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
 * Endpoint: ${method} ${endpoint}
 */

`;

      for (let i = 0; i < errors.length; i++) {
        const error = errors[i];
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.2: –ï—Å–ª–∏ requestBody —Å—Ç—Ä–æ–∫–∞ - –ø–∞—Ä—Å–∏–º –ø–µ—Ä–µ–¥ stringify
        let requestBodyForExport = error.requestBody;
        if (typeof requestBodyForExport === 'string') {
          try {
            requestBodyForExport = JSON.parse(requestBodyForExport);
          } catch {
            // –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
          }
        }
        dataCode += `export const requestData${i + 1} = ${JSON.stringify(requestBodyForExport, null, 2)};\n\n`;
        dataCode += `export const expectedError${i + 1} = ${JSON.stringify({
          status: 422,
          detailMessage: error.detailMessage,
          responseData: error.responseData
        }, null, 2)};\n\n`;
      }

      fs.writeFileSync(dataFilePath, dataCode, 'utf-8');

      // –ò–º–ø–æ—Ä—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      const relativeDataPath = path.relative(path.dirname(testFilePath), dataFilePath).replace(/\.ts$/, '');
      code += `import {\n`;
      for (let i = 0; i < errors.length; i++) {
        code += `  requestData${i + 1},\n`;
        code += `  expectedError${i + 1},\n`;
      }
      code += `} from './${relativeDataPath.startsWith('.') ? relativeDataPath : './' + relativeDataPath}';\n`;
    }

    // –ù–û–í–û–ï v14.5.8: –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è Content-Length
    code += `
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.8: –£–¥–∞–ª—è–µ—Ç Content-Length –∏–∑ axios –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤—ã–∑—ã–≤–∞–µ—Ç 502 –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±–µ–∫–µ–Ω–¥–∞—Ö)
function getAxiosConfigWithoutContentLength(axiosConfig: any): any {
  return {
    ...axiosConfig,
    transformRequest: [
      (data: any, headers: any) => {
        if (headers) {
          delete headers['Content-Length'];
          delete headers['content-length'];
        }
        return typeof data === 'string' ? data : JSON.stringify(data);
      }
    ]
  };
}

const httpMethod = '${method}';

test.describe('${method} ${endpoint} - Validation Tests ${testTag}', () => {
`;

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç—ã
    for (let i = 0; i < errors.length; i++) {
      const error = errors[i];
      code += await this.generateSingle422Test(error, i + 1, standUrlVar, axiosConfig, createDataFiles ?? true);
      code += '\n';
    }

    code += `});
`;

    return code;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –Ω–∞ 422 –æ—à–∏–±–∫—É
   */
  private async generateSingle422Test(
    error: Validation422Error,
    testNumber: number,
    standUrlVar: string,
    axiosConfig: string,
    useDataFiles: boolean
  ): Promise<string> {
    const hasBody = ['POST', 'PUT', 'PATCH'].includes(error.method);
    const shortMessage = error.detailMessage.length > 50
      ? error.detailMessage.substring(0, 47) + '...'
      : error.detailMessage;

    let testCode = `  test(\`Validation #${testNumber}: ${shortMessage.replace(/`/g, "'")} (422) @api ${this.config.validationTests.testTag || '@apiValidation'}\`, async ({ page }, testInfo) => {
    // Request ID: ${error.requestId}
    const actualEndpoint = '${error.endpoint}';
`;

    // –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞
    if (useDataFiles) {
      if (hasBody) {
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.7: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–ø–∏—è –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤ –∏ –æ–±—ä–µ–∫—Ç–æ–≤
        testCode += `    const requestData = Array.isArray(requestData${testNumber}) ? [...requestData${testNumber}] : { ...requestData${testNumber} };
`;
      }
      testCode += `    const expectedErrorData = expectedError${testNumber};
`;
    } else {
      if (hasBody) {
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.2: –ï—Å–ª–∏ requestBody —Å—Ç—Ä–æ–∫–∞ - –ø–∞—Ä—Å–∏–º –ø–µ—Ä–µ–¥ stringify
        let requestBodyObj = error.requestBody;
        if (typeof requestBodyObj === 'string') {
          try {
            requestBodyObj = JSON.parse(requestBodyObj);
          } catch {
            // –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
          }
        }
        testCode += `    const requestData = ${JSON.stringify(requestBodyObj, null, 4).replace(/^/gm, '    ')};
`;
      }
      testCode += `    const expectedErrorData = {
      status: 422,
      detailMessage: ${JSON.stringify(error.detailMessage)},
    };
`;
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
    testCode += `
    let response;
    let errorCaught = false;

    try {
`;

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.8: –ò—Å–ø–æ–ª—å–∑—É–µ–º getAxiosConfigWithoutContentLength –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è Content-Length
    if (hasBody) {
      testCode += `      response = await axios.${error.method.toLowerCase()}(${standUrlVar} + actualEndpoint, requestData, getAxiosConfigWithoutContentLength(${axiosConfig}));
`;
    } else {
      testCode += `      response = await axios.${error.method.toLowerCase()}(${standUrlVar} + actualEndpoint, getAxiosConfigWithoutContentLength(${axiosConfig}));
`;
    }

    testCode += `    } catch (error: any) {
      errorCaught = true;
      response = error.response;

      // –ï—Å–ª–∏ —ç—Ç–æ –ù–ï 422 - –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
      if (!response || response.status !== 422) {
`;

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
    const use5xxEmail = this.config.send5xxEmailNotification && this.config.emailHelperPath;
    const emailMethodName = this.config.emailHelperMethodName || 'sendErrorMailbyApi';

    if (this.config.apiTestHelperPath) {
      testCode += `        await handleApiError({
          error,
          testInfo,
          endpoint: actualEndpoint,
          method: httpMethod,
          standUrl: ${standUrlVar},${hasBody ? `
          requestBody: requestData,` : ''}
          axiosConfig: ${axiosConfig},${use5xxEmail ? `
          sendEmailFn: ${emailMethodName}` : ''}
        });
`;
    } else {
      testCode += `        console.error('‚ùå –û–∂–∏–¥–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ 422, –Ω–æ –ø–æ–ª—É—á–µ–Ω–∞:', response?.status || error.message);
        throw error;
`;
    }

    testCode += `      }
    }

    // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –≤–µ—Ä–Ω—É–ª —É—Å–ø–µ—Ö –≤–º–µ—Å—Ç–æ 422
    if (!errorCaught) {
      console.error('\\n‚ùå –û–∂–∏–¥–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ 422, –Ω–æ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω');
      console.error('üìç Endpoint:', actualEndpoint, '| Method:', httpMethod);
      console.error('üìç Full URL:', ${standUrlVar} + actualEndpoint);
      console.error('üìã Response status:', response?.status);
      console.error('üìã Response data:', JSON.stringify(response?.data, null, 2));
`;

    if (hasBody) {
      testCode += `      const curlCmd422 = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' -H 'Content-Type: application/json' -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}' -d '\${JSON.stringify(requestData)}'\`;
      console.error('üìã CURL:', curlCmd422);
`;
    } else {
      testCode += `      const curlCmd422 = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}'\`;
      console.error('üìã CURL:', curlCmd422);
`;
    }

    testCode += `    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω—É–ª 422
    await expect(errorCaught, '–û–∂–∏–¥–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ 422, –Ω–æ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω').toBe(true);
    await expect(response).toBeDefined();
    await expect(response.status).toBe(422);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    const responseDetail = response.data?.detail || response.data?.message || response.data?.error || JSON.stringify(response.data);

    if (responseDetail !== expectedErrorData.detailMessage) {
      console.log('\\nüìã –†–∞–∑–ª–∏—á–∏–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ–± –æ—à–∏–±–∫–µ:');
      console.log('–û–∂–∏–¥–∞–ª–æ—Å—å:', expectedErrorData.detailMessage);
      console.log('–ü–æ–ª—É—á–µ–Ω–æ:', responseDetail);
      console.log('\\nüìç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—Ä–æ—Å–µ:');
      console.log('Endpoint:', actualEndpoint);
      console.log('Method:', httpMethod);
      console.log('Full URL:', ${standUrlVar} + actualEndpoint);
`;

    // CURL –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    if (hasBody) {
      testCode += `
      // CURL –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
      const curlCmd = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' \\\\
  -H 'Content-Type: application/json' \\\\
  -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}' \\\\
  -d '\${JSON.stringify(requestData)}'\`;
      console.log('\\nüìã CURL –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:');
      console.log(curlCmd);
`;
    } else {
      testCode += `
      // CURL –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
      const curlCmd = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' \\\\
  -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}'\`;
      console.log('\\nüìã CURL –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:');
      console.log(curlCmd);
`;
    }

    testCode += `    }

    // –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è - –≤—ã–≤–æ–¥–∏–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–æ –Ω–µ –ø–∞–¥–∞–µ–º
    // (—Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è, –≥–ª–∞–≤–Ω–æ–µ - —á—Ç–æ –≤–µ—Ä–Ω—É–ª—Å—è 422)
    if (responseDetail !== expectedErrorData.detailMessage) {
      console.warn('‚ö†Ô∏è  –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (—Ç–µ—Å—Ç –ù–ï –ø–∞–¥–∞–µ—Ç, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è)');
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - —Å—Ç–∞—Ç—É—Å 422
    await expect(response.status, '–û–∂–∏–¥–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å 422 Unprocessable Entity').toBe(422);
  });`;

    return testCode;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // –ù–û–í–û–ï v14.4: –ì–ï–ù–ï–†–ê–¶–ò–Ø –¢–ï–°–¢–û–í –ù–ê 400 –û–®–ò–ë–ö–ò (–î–£–ë–õ–ò–ö–ê–¢–´)
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è 400 –æ—à–∏–±–æ–∫ "–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç":
   * - –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç: –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí 400 + –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
   * –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.5: –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã —É–±—Ä–∞–Ω—ã (–±—ã–ª–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã)
   */
  async generate400DuplicateTests(duplicate400Errors: Duplicate400Error[]): Promise<void> {
    if (!this.config.duplicateTests.enabled || duplicate400Errors.length === 0) {
      return;
    }

    console.log(`\nüìã –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (400)...`);
    console.log(`   –ù–∞–π–¥–µ–Ω–æ ${duplicate400Errors.length} –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π`);

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
    const duplicateOutputDir = path.resolve(this.config.duplicateTests.outputDir || './tests/api/negative-400');

    if (!fs.existsSync(duplicateOutputDir)) {
      fs.mkdirSync(duplicateOutputDir, { recursive: true });
    }

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ endpoint + method
    const grouped = this.groupDuplicate400Errors(duplicate400Errors);

    let totalTests = 0;
    let newTests = 0;

    for (const [key, errors] of Object.entries(grouped)) {
      const { total, added } = await this.generate400TestsForEndpoint(key, errors, duplicateOutputDir);
      totalTests += total;
      newTests += added;
    }

    console.log(`\n‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞!`);
    console.log(`   –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${totalTests}`);
    console.log(`   –ù–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤: ${newTests}`);
  }

  /**
   * –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç 400 –æ—à–∏–±–∫–∏ –ø–æ endpoint + method
   */
  private groupDuplicate400Errors(errors: Duplicate400Error[]): Record<string, Duplicate400Error[]> {
    const grouped: Record<string, Duplicate400Error[]> = {};
    const maxTests = this.config.duplicateTests.maxTestsPerEndpoint || 2;

    for (const error of errors) {
      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º endpoint (–∑–∞–º–µ–Ω—è–µ–º —á–∏—Å–ª–∞ –Ω–∞ {id})
      const normalizedEndpoint = error.endpoint.replace(/\/\d+/g, '/{id}');
      const key = `${error.method}:${normalizedEndpoint}`;

      if (!grouped[key]) {
        grouped[key] = [];
      }

      if (grouped[key].length < maxTests) {
        grouped[key].push(error);
      }
    }

    return grouped;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ endpoint
   */
  private async generate400TestsForEndpoint(
    key: string,
    errors: Duplicate400Error[],
    outputDir: string
  ): Promise<{ total: number; added: number }> {
    const [method, endpoint] = key.split(':');

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ –ø–∞–ø–∫–∞–º)
    let category = '';
    if (this.config.duplicateTests.groupByCategory) {
      const parts = endpoint.split('/').filter(Boolean);
      const startIndex = parts.findIndex(p => p.match(/^v\d+$/));
      if (startIndex >= 0 && parts[startIndex + 1]) {
        category = parts[startIndex + 1];
      } else if (parts.length > 0) {
        category = parts[0];
      }
    }

    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
    const fileName = this.endpointToFileName(endpoint, method) + '-duplicate-400';
    const categoryDir = category ? path.join(outputDir, category) : outputDir;

    if (!fs.existsSync(categoryDir)) {
      fs.mkdirSync(categoryDir, { recursive: true });
    }

    const testFilePath = path.join(categoryDir, `${fileName}.test.ts`);
    const testDataDir = path.join(categoryDir, 'test-data');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ñ–∞–π–ª
    if (fs.existsSync(testFilePath) && !this.config.force) {
      console.log(`  ‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç): ${fileName}`);
      return { total: errors.length * 2, added: 0 }; // *2 –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–∞—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
    const testCode = await this.generate400TestFile(endpoint, method, errors, testDataDir, testFilePath);

    fs.writeFileSync(testFilePath, testCode, 'utf-8');
    console.log(`  ‚úì –°–æ–∑–¥–∞–Ω: ${fileName} (${errors.length * 2} —Ç–µ—Å—Ç–æ–≤: ${errors.length} –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö + ${errors.length} –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö)`);

    return { total: errors.length * 2, added: errors.length * 2 };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ —Ñ–∞–π–ª–∞ —Å –ø–∞—Ä–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏ –Ω–∞ 400
   */
  private async generate400TestFile(
    endpoint: string,
    method: string,
    errors: Duplicate400Error[],
    testDataDir: string,
    testFilePath: string
  ): Promise<string> {
    const standUrlVar = `process.env.${this.config.standUrlEnvVar}`;
    const axiosConfig = this.config.axiosConfigName;
    const testTag = this.config.duplicateTests.testTag || '@negative400Validation';
    const createDataFiles = this.config.duplicateTests.createSeparateDataFiles;

    // –ò–º–ø–æ—Ä—Ç—ã
    let code = `/**
 * –ü–∞—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (400 –æ—à–∏–±–∫–∏)
 * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${new Date().toISOString()}
 * Endpoint: ${method} ${endpoint}
 *
 * –≠—Ç–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:
 * - –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π: –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí 400 + —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
 * - –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π: –¥–∞–Ω–Ω—ã–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ ‚Üí 2xx + –ø—Ä–æ–≤–µ—Ä–∫–∞ response
 */

import { test, expect } from '${this.config.testImportPath}';
import axios from 'axios';
import { ${axiosConfig} } from '${this.config.axiosConfigPath}';
`;

    // –ò–º–ø–æ—Ä—Ç apiTestHelper –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
    if (this.config.apiTestHelperPath) {
      code += `import { handleApiError, getMessageFromError } from '${this.config.apiTestHelperPath}';\n`;
    }

    // –ò–º–ø–æ—Ä—Ç compareDbWithResponse –¥–ª—è –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
    code += `import { compareDbWithResponse } from '${this.config.packageName}';\n`;

    // –ò–º–ø–æ—Ä—Ç email helper –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
    if (this.config.send5xxEmailNotification && this.config.emailHelperPath) {
      code += `import { ${this.config.emailHelperMethodName || 'sendErrorMailbyApi'} } from '${this.config.emailHelperPath}';\n`;
    }

    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    if (createDataFiles) {
      // –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É test-data
      if (!fs.existsSync(testDataDir)) {
        fs.mkdirSync(testDataDir, { recursive: true });
      }

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∞–π–ª —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
      const dataFileName = this.endpointToFileName(endpoint, method) + '-duplicate-400-data';
      const dataFilePath = path.join(testDataDir, `${dataFileName}.ts`);

      let dataCode = `/**
 * –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–∞—Ä–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã (400)
 * Endpoint: ${method} ${endpoint}
 */

`;

      for (let i = 0; i < errors.length; i++) {
        const error = errors[i];
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.2: –ï—Å–ª–∏ requestBody —Å—Ç—Ä–æ–∫–∞ - –ø–∞—Ä—Å–∏–º –ø–µ—Ä–µ–¥ stringify
        let requestBodyForExport = error.requestBody;
        if (typeof requestBodyForExport === 'string') {
          try {
            requestBodyForExport = JSON.parse(requestBodyForExport);
          } catch {
            // –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
          }
        }
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.5: –£–±—Ä–∞–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è expectedSuccess (–ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã)
        dataCode += `// –¢–µ—Å—Ç #${i + 1}\n`;
        dataCode += `export const requestData${i + 1} = ${JSON.stringify(requestBodyForExport, null, 2)};\n\n`;
        dataCode += `export const expectedError${i + 1} = ${JSON.stringify({
          status: 400,
          detailMessage: error.detailMessage,
          responseData: error.responseData
        }, null, 2)};\n\n`;
      }

      fs.writeFileSync(dataFilePath, dataCode, 'utf-8');

      // –ò–º–ø–æ—Ä—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤)
      const relativeDataPath = path.relative(path.dirname(testFilePath), dataFilePath).replace(/\.ts$/, '');
      code += `import {\n`;
      for (let i = 0; i < errors.length; i++) {
        code += `  requestData${i + 1},\n`;
        code += `  expectedError${i + 1},\n`;
      }
      code += `} from './${relativeDataPath.startsWith('.') ? relativeDataPath : './' + relativeDataPath}';\n`;
    }

    // –ù–û–í–û–ï v14.5.8: –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è Content-Length
    code += `
// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.8: –£–¥–∞–ª—è–µ—Ç Content-Length –∏–∑ axios –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤—ã–∑—ã–≤–∞–µ—Ç 502 –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±–µ–∫–µ–Ω–¥–∞—Ö)
function getAxiosConfigWithoutContentLength(axiosConfig: any): any {
  return {
    ...axiosConfig,
    transformRequest: [
      (data: any, headers: any) => {
        if (headers) {
          delete headers['Content-Length'];
          delete headers['content-length'];
        }
        return typeof data === 'string' ? data : JSON.stringify(data);
      }
    ]
  };
}

const httpMethod = '${method}';

test.describe('${method} ${endpoint} - Duplicate Tests ${testTag}', () => {
`;

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.5: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã (–±–µ–∑ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö)
    // –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å uniqueFields —É–±—Ä–∞–Ω—ã, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã
    for (let i = 0; i < errors.length; i++) {
      const error = errors[i];
      // –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç (400) - –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 + —Å–æ–æ–±—â–µ–Ω–∏–µ
      code += await this.generateSingle400NegativeTest(error, i + 1, standUrlVar, axiosConfig, createDataFiles ?? true);
      code += '\n';
    }

    code += `});
`;

    return code;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç: –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí 400
   */
  private async generateSingle400NegativeTest(
    error: Duplicate400Error,
    testNumber: number,
    standUrlVar: string,
    axiosConfig: string,
    useDataFiles: boolean
  ): Promise<string> {
    const hasBody = ['POST', 'PUT', 'PATCH'].includes(error.method);
    const shortMessage = error.detailMessage.length > 40
      ? error.detailMessage.substring(0, 37) + '...'
      : error.detailMessage;

    let testCode = `  test(\`Negative #${testNumber}: ${shortMessage.replace(/`/g, "'")} (400) @api ${this.config.duplicateTests.testTag || '@negative400Validation'}\`, async ({ page }, testInfo) => {
    // Request ID: ${error.requestId}
    // –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç: –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å 400 "–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    const actualEndpoint = '${error.endpoint}';
`;

    // –î–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞
    if (useDataFiles) {
      if (hasBody) {
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.7: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–ø–∏—è –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤ –∏ –æ–±—ä–µ–∫—Ç–æ–≤
        testCode += `    const requestData = Array.isArray(requestData${testNumber}) ? [...requestData${testNumber}] : { ...requestData${testNumber} };
`;
      }
      testCode += `    const expectedErrorData = expectedError${testNumber};
`;
    } else {
      if (hasBody) {
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.2: –ï—Å–ª–∏ requestBody —Å—Ç—Ä–æ–∫–∞ - –ø–∞—Ä—Å–∏–º –ø–µ—Ä–µ–¥ stringify
        let requestBodyObj = error.requestBody;
        if (typeof requestBodyObj === 'string') {
          try {
            requestBodyObj = JSON.parse(requestBodyObj);
          } catch {
            // –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
          }
        }
        testCode += `    const requestData = ${JSON.stringify(requestBodyObj, null, 4).replace(/^/gm, '    ')};
`;
      }
      testCode += `    const expectedErrorData = {
      status: 400,
      detailMessage: ${JSON.stringify(error.detailMessage)},
    };
`;
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
    testCode += `
    let response;
    let errorCaught = false;

    try {
`;

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï v14.5.8: –ò—Å–ø–æ–ª—å–∑—É–µ–º getAxiosConfigWithoutContentLength –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è Content-Length
    if (hasBody) {
      testCode += `      response = await axios.${error.method.toLowerCase()}(${standUrlVar} + actualEndpoint, requestData, getAxiosConfigWithoutContentLength(${axiosConfig}));
`;
    } else {
      testCode += `      response = await axios.${error.method.toLowerCase()}(${standUrlVar} + actualEndpoint, getAxiosConfigWithoutContentLength(${axiosConfig}));
`;
    }

    testCode += `    } catch (error: any) {
      errorCaught = true;
      response = error.response;

      // –ï—Å–ª–∏ —ç—Ç–æ –ù–ï 400 - –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
      if (!response || response.status !== 400) {
`;

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
    const use5xxEmail = this.config.send5xxEmailNotification && this.config.emailHelperPath;
    const emailMethodName = this.config.emailHelperMethodName || 'sendErrorMailbyApi';

    if (this.config.apiTestHelperPath) {
      testCode += `        await handleApiError({
          error,
          testInfo,
          endpoint: actualEndpoint,
          method: httpMethod,
          standUrl: ${standUrlVar},${hasBody ? `
          requestBody: requestData,` : ''}
          axiosConfig: ${axiosConfig},${use5xxEmail ? `
          sendEmailFn: ${emailMethodName}` : ''}
        });
`;
    } else {
      testCode += `        console.error('‚ùå –û–∂–∏–¥–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ 400, –Ω–æ –ø–æ–ª—É—á–µ–Ω–∞:', response?.status || error.message);
        throw error;
`;
    }

    testCode += `      }
    }

    // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –≤–µ—Ä–Ω—É–ª —É—Å–ø–µ—Ö –≤–º–µ—Å—Ç–æ 400
    if (!errorCaught) {
      console.error('\\n‚ùå –û–∂–∏–¥–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ 400 (–¥—É–±–ª–∏–∫–∞—Ç), –Ω–æ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω');
      console.error('üìç Endpoint:', actualEndpoint, '| Method:', httpMethod);
      console.error('üìç Full URL:', ${standUrlVar} + actualEndpoint);
      console.error('üìã Response status:', response?.status);
      console.error('üìã Response data:', JSON.stringify(response?.data, null, 2));
`;

    if (hasBody) {
      testCode += `      const curlCmd400 = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' -H 'Content-Type: application/json' -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}' -d '\${JSON.stringify(requestData)}'\`;
      console.error('üìã CURL:', curlCmd400);
`;
    } else {
      testCode += `      const curlCmd400 = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}'\`;
      console.error('üìã CURL:', curlCmd400);
`;
    }

    testCode += `    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω—É–ª 400
    await expect(errorCaught, '–û–∂–∏–¥–∞–ª–∞—Å—å –æ—à–∏–±–∫–∞ 400 (–¥—É–±–ª–∏–∫–∞—Ç), –Ω–æ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω').toBe(true);
    await expect(response).toBeDefined();
    await expect(response.status).toBe(400);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ response)
    const responseDetail = response.data?.detail || response.data?.message || response.data?.error || JSON.stringify(response.data);

    // –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
    if (responseDetail !== expectedErrorData.detailMessage) {
      console.error('\\n‚ö†Ô∏è  –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ 400 –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç');
      console.error('üìç Endpoint:', actualEndpoint, '| Method:', httpMethod);
      console.error('–û–∂–∏–¥–∞–ª–æ—Å—å:', expectedErrorData.detailMessage);
      console.error('–ü–æ–ª—É—á–µ–Ω–æ:', responseDetail);
`;

    if (hasBody) {
      testCode += `      const curlCmd400Msg = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' -H 'Content-Type: application/json' -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}' -d '\${JSON.stringify(requestData)}'\`;
      console.error('üìã CURL:', curlCmd400Msg);
`;
    } else {
      testCode += `      const curlCmd400Msg = \`curl -X \${httpMethod} '\${${standUrlVar}}\${actualEndpoint}' -H 'Authorization: \${${axiosConfig}?.headers?.Authorization || ${axiosConfig}?.headers?.authorization || 'Bearer YOUR_TOKEN'}'\`;
      console.error('üìã CURL:', curlCmd400Msg);
`;
    }

    testCode += `    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¢–û–ß–ù–û–ì–û —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è (–≤–∑—è—Ç–æ –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API)
    await expect(responseDetail, '–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å').toBe(expectedErrorData.detailMessage);
  });`;

    return testCode;
  }

  // –£–î–ê–õ–ï–ù–û v14.5.5: generateSingle400PositiveTest —É–±—Ä–∞–Ω
  // –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å uniqueFields –±—ã–ª–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã, –æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã
}

export async function generateHappyPathTests(
    config: HappyPathTestConfig,
    sqlConnection: any
): Promise<void> {
  const generator = new HappyPathTestGenerator(config, sqlConnection);
  await generator.generate();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ù–û–í–û–ï v14.1: –ü–ï–†–ï–ê–ö–¢–£–ê–õ–ò–ó–ê–¶–ò–Ø –¢–ï–°–¢–û–í–´–• –î–ê–ù–ù–´–•
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

/**
 * –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
 */
export interface ReActualizeConfig {
  /**
   * –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ Happy Path —Ç–µ—Å—Ç–∞–º–∏
   * @example './e2e/api/happy-path'
   */
  testsDir: string;

  /**
   * –§–∏–ª—å—Ç—Ä endpoints –¥–ª—è –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
   * –ï—Å–ª–∏ –ø—É—Å—Ç–æ–π - –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –≤—Å–µ endpoints
   * @example ['/api/v1/orders', '/api/v1/users/{id}']
   */
  endpointFilter?: string[];

  /**
   * URL —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞
   * @example 'https://api.example.com'
   */
  standUrl: string;

  /**
   * Axios –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   * @example { headers: { Authorization: 'Bearer xxx' } }
   */
  axiosConfig: any;

  /**
   * –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–∞—Ö
   * –ï—Å–ª–∏ false - —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
   * @default true
   */
  updateFiles?: boolean;

  /**
   * –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   * @default false
   */
  debug?: boolean;
}

/**
 * –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
 */
export interface ReActualizeResult {
  totalTests: number;
  updatedTests: number;
  skippedTests: number;
  failedTests: number;
  details: Array<{
    testFile: string;
    endpoint: string;
    method: string;
    status: 'updated' | 'skipped' | 'failed' | 'unchanged';
    reason?: string;
    changedFields?: string[];
  }>;
}

/**
 * –ù–û–í–û–ï v14.1: –ü–µ—Ä–µ–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö Happy Path —Ç–µ—Å—Ç–æ–≤
 *
 * –≠—Ç–æ—Ç –º–µ—Ç–æ–¥:
 * 1. –°–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–∞–ø–∫—É —Å —Ç–µ—Å—Ç–∞–º–∏
 * 2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç endpoint –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
 * 3. –í—ã–∑—ã–≤–∞–µ—Ç endpoint –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Å—Ç–µ–Ω–¥–µ
 * 4. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –æ–∂–∏–¥–∞–µ–º—ã–º–∏ –≤ —Ç–µ—Å—Ç–µ
 * 5. –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–∞–∑–ª–∏—á–∏—è
 *
 * @example
 * await reActualizeHappyPathTests({
 *   testsDir: './e2e/api/happy-path',
 *   standUrl: 'https://api.example.com',
 *   axiosConfig: { headers: { Authorization: 'Bearer xxx' } },
 *   endpointFilter: ['/api/v1/orders'], // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
 *   updateFiles: true
 * });
 */
export async function reActualizeHappyPathTests(
  config: ReActualizeConfig
): Promise<ReActualizeResult> {
  const {
    testsDir,
    endpointFilter = [],
    standUrl,
    axiosConfig,
    updateFiles = true,
    debug = false
  } = config;

  console.log('üîÑ –ù–∞—á–∏–Ω–∞—é –ø–µ—Ä–µ–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
  console.log(`üìÅ –ü–∞–ø–∫–∞ —Å —Ç–µ—Å—Ç–∞–º–∏: ${testsDir}`);

  if (endpointFilter.length > 0) {
    console.log(`üîç –§–∏–ª—å—Ç—Ä endpoints: ${endpointFilter.join(', ')}`);
  } else {
    console.log('üîç –ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –í–°–ï–• endpoints');
  }

  const result: ReActualizeResult = {
    totalTests: 0,
    updatedTests: 0,
    skippedTests: 0,
    failedTests: 0,
    details: []
  };

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏
  if (!fs.existsSync(testsDir)) {
    console.error(`‚ùå –ü–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${testsDir}`);
    return result;
  }

  // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
  const testFiles = getTestFilesRecursively(testsDir);
  console.log(`üìã –ù–∞–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤: ${testFiles.length}`);

  for (const testFile of testFiles) {
    if (debug) {
      console.log(`\nüìÑ –û–±—Ä–∞–±–æ—Ç–∫–∞: ${path.relative(testsDir, testFile)}`);
    }

    try {
      const fileContent = fs.readFileSync(testFile, 'utf-8');

      // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ—Å—Ç–µ
      const testInfo = extractTestInfo(fileContent);

      if (!testInfo) {
        if (debug) {
          console.log(`  ‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ—Å—Ç–µ`);
        }
        result.skippedTests++;
        result.details.push({
          testFile,
          endpoint: 'unknown',
          method: 'unknown',
          status: 'skipped',
          reason: 'Could not extract test info'
        });
        continue;
      }

      result.totalTests++;

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–ª—å—Ç—Ä endpoints
      if (endpointFilter.length > 0) {
        const matchesFilter = endpointFilter.some(filter => {
          const normalizedFilter = filter.replace(/\{[^}]+\}/g, '{id}');
          const normalizedEndpoint = testInfo.endpoint.replace(/\{[^}]+\}/g, '{id}').replace(/\/\d+/g, '/{id}');
          return normalizedEndpoint.includes(normalizedFilter) || normalizedFilter.includes(normalizedEndpoint);
        });

        if (!matchesFilter) {
          if (debug) {
            console.log(`  ‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω (–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∏–ª—å—Ç—Ä—É)`);
          }
          result.skippedTests++;
          result.details.push({
            testFile,
            endpoint: testInfo.endpoint,
            method: testInfo.method,
            status: 'skipped',
            reason: 'Does not match endpoint filter'
          });
          continue;
        }
      }

      // –í—ã–∑—ã–≤–∞–µ–º endpoint
      console.log(`  üåê ${testInfo.method} ${testInfo.endpoint}`);

      try {
        const fullUrl = standUrl + testInfo.endpoint;
        let response;

        if (['POST', 'PUT', 'PATCH'].includes(testInfo.method.toUpperCase())) {
          response = await axios({
            method: testInfo.method.toLowerCase(),
            url: fullUrl,
            data: testInfo.requestData,
            ...axiosConfig
          });
        } else {
          response = await axios({
            method: testInfo.method.toLowerCase(),
            url: fullUrl,
            ...axiosConfig
          });
        }

        // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        const comparison = compareResponses(testInfo.expectedResponse, response.data);

        if (comparison.isEqual) {
          console.log(`    ‚úÖ –î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã`);
          result.details.push({
            testFile,
            endpoint: testInfo.endpoint,
            method: testInfo.method,
            status: 'unchanged'
          });
        } else {
          console.log(`    üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è: ${comparison.changedFields.join(', ')}`);

          if (updateFiles) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª
            const updatedContent = updateTestDataInFile(fileContent, response.data, testInfo);
            fs.writeFileSync(testFile, updatedContent, 'utf-8');
            console.log(`    ‚úÖ –§–∞–π–ª –æ–±–Ω–æ–≤–ª—ë–Ω`);
            result.updatedTests++;
          } else {
            console.log(`    ‚ÑπÔ∏è  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø—Ä–æ–ø—É—â–µ–Ω–æ (updateFiles: false)`);
          }

          result.details.push({
            testFile,
            endpoint: testInfo.endpoint,
            method: testInfo.method,
            status: 'updated',
            changedFields: comparison.changedFields
          });
        }

      } catch (apiError: any) {
        const status = apiError.response?.status;
        console.log(`    ‚ùå –û—à–∏–±–∫–∞ API: ${status || apiError.message}`);
        result.failedTests++;
        result.details.push({
          testFile,
          endpoint: testInfo.endpoint,
          method: testInfo.method,
          status: 'failed',
          reason: `API error: ${status || apiError.message}`
        });
      }

    } catch (error: any) {
      console.error(`  ‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: ${error.message}`);
      result.failedTests++;
      result.details.push({
        testFile,
        endpoint: 'unknown',
        method: 'unknown',
        status: 'failed',
        reason: error.message
      });
    }
  }

  // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  console.log('\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:');
  console.log(`   –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${result.totalTests}`);
  console.log(`   –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${result.updatedTests}`);
  console.log(`   –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${result.skippedTests}`);
  console.log(`   –û—à–∏–±–æ–∫: ${result.failedTests}`);

  return result;
}

/**
 * –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ .test.ts —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏
 */
function getTestFilesRecursively(dir: string): string[] {
  const files: string[] = [];

  if (!fs.existsSync(dir)) return files;

  const items = fs.readdirSync(dir);

  for (const item of items) {
    const fullPath = path.join(dir, item);
    const stat = fs.statSync(fullPath);

    if (stat.isDirectory() && !item.startsWith('.') && item !== 'node_modules' && item !== 'test-data') {
      files.push(...getTestFilesRecursively(fullPath));
    } else if (stat.isFile() && item.endsWith('.happy-path.test.ts')) {
      files.push(fullPath);
    }
  }

  return files;
}

/**
 * –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ—Å—Ç–µ –∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞
 */
function extractTestInfo(content: string): {
  endpoint: string;
  method: string;
  requestData: any;
  expectedResponse: any;
} | null {
  try {
    // –ò–∑–≤–ª–µ–∫–∞–µ–º endpoint
    const endpointMatch = content.match(/const endpoint = ['"`]([^'"`]+)['"`]/);
    if (!endpointMatch) return null;

    // –ò–∑–≤–ª–µ–∫–∞–µ–º –º–µ—Ç–æ–¥
    const methodMatch = content.match(/const httpMethod = ['"`]([^'"`]+)['"`]/);
    if (!methodMatch) return null;

    // –ò–∑–≤–ª–µ–∫–∞–µ–º actualEndpoint (—Ä–µ–∞–ª—å–Ω—ã–π endpoint —Å –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ ID)
    const actualEndpointMatch = content.match(/const actualEndpoint = ['"`]([^'"`]+)['"`]/);

    // –ò–∑–≤–ª–µ–∫–∞–µ–º requestData
    let requestData = {};
    const requestDataMatch = content.match(/const requestData = (\{[\s\S]*?\});/);
    if (requestDataMatch) {
      try {
        // –ü—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON-–ø–æ–¥–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        const jsonLike = requestDataMatch[1]
          .replace(/'/g, '"')
          .replace(/(\w+):/g, '"$1":')
          .replace(/,\s*}/g, '}')
          .replace(/,\s*]/g, ']');
        requestData = JSON.parse(jsonLike);
      } catch {
        // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç
      }
    }

    // –ò–∑–≤–ª–µ–∫–∞–µ–º normalizedExpected
    let expectedResponse = {};
    const normalizedMatch = content.match(/const normalizedExpected = (\{[\s\S]*?\});/);
    if (normalizedMatch) {
      try {
        const jsonLike = normalizedMatch[1]
          .replace(/'/g, '"')
          .replace(/(\w+):/g, '"$1":')
          .replace(/,\s*}/g, '}')
          .replace(/,\s*]/g, ']');
        expectedResponse = JSON.parse(jsonLike);
      } catch {
        // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç
      }
    }

    return {
      endpoint: actualEndpointMatch ? actualEndpointMatch[1] : endpointMatch[1],
      method: methodMatch[1],
      requestData,
      expectedResponse
    };
  } catch {
    return null;
  }
}

/**
 * –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–≤–∞ –æ—Ç–≤–µ—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
 */
function compareResponses(expected: any, actual: any): {
  isEqual: boolean;
  changedFields: string[];
} {
  const changedFields: string[] = [];

  function compare(exp: any, act: any, prefix: string = '') {
    if (exp === null && act === null) return;
    if (exp === undefined && act === undefined) return;

    if (typeof exp !== typeof act) {
      changedFields.push(prefix || 'root');
      return;
    }

    if (Array.isArray(exp) && Array.isArray(act)) {
      if (exp.length !== act.length) {
        changedFields.push(`${prefix}[length]`);
      }
      for (let i = 0; i < Math.min(exp.length, act.length); i++) {
        compare(exp[i], act[i], `${prefix}[${i}]`);
      }
      return;
    }

    if (typeof exp === 'object' && exp !== null) {
      const allKeys = new Set([...Object.keys(exp || {}), ...Object.keys(act || {})]);
      for (const key of allKeys) {
        const newPrefix = prefix ? `${prefix}.${key}` : key;
        if (!(key in exp)) {
          changedFields.push(`${newPrefix} (new)`);
        } else if (!(key in act)) {
          changedFields.push(`${newPrefix} (removed)`);
        } else {
          compare(exp[key], act[key], newPrefix);
        }
      }
      return;
    }

    if (exp !== act) {
      changedFields.push(prefix || 'root');
    }
  }

  compare(expected, actual);

  return {
    isEqual: changedFields.length === 0,
    changedFields
  };
}

/**
 * –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ
 */
function updateTestDataInFile(
  content: string,
  newResponseData: any,
  testInfo: { endpoint: string; method: string }
): string {
  // –ù–∞—Ö–æ–¥–∏–º –∏ –∑–∞–º–µ–Ω—è–µ–º normalizedExpected
  const normalizedExpectedRegex = /(const normalizedExpected = )(\{[\s\S]*?\})(;)/;

  if (normalizedExpectedRegex.test(content)) {
    const formattedData = JSON.stringify(newResponseData, null, 4)
      .split('\n')
      .map((line, i) => i === 0 ? line : '    ' + line)
      .join('\n');

    return content.replace(normalizedExpectedRegex, `$1${formattedData}$3`);
  }

  return content;
}